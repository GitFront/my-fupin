$(function(){function t(t,e){y===w?t&&t():y===A&&$.ajax({url:URLS.URL_TPL_POOR_FILE,dataType:"text",success:function(e){y||($("body").append(e),_=$("#popupCountryFile"),g=$("#popupFamilyFile"),L=_.find(".popup-content"),b=g.find(".popup-content"),_.on(C,".btn-close",m),g.on(C,".btn-close",h),y=!0),y=w,t&&t()},error:function(){}})}function n(t){t.find(".avatar img").each(function(){var t=this,e=$(t);t.onerror=function(){e.data("tried")||(t.src="../../../static/themes/images/fupin_strategy/default_avatar.jpg",e.data("tried",!0))}})}function a(t,n){var a,i,d=b.find(".page-tabs"),f=d.find("li."+v),u=b.find(".page-tab-content");if(f.attr("data-target")!=n){switch(d.find('li[data-target="'+n+'"]').addClass(v).siblings("li").removeClass(v),u.empty(),n){case N.MEMBERS:a=URLS.URL_FAMILY_FILE_MEMBERS,i=function(t){function n(){s.hide(),l.show()}function a(t){i||(i=d.find(".ul").owlCarousel({items:1,loop:!0,mouseTouch:!1}).on("changed.owl.carousel",function(t){o.text(t.page.index+1)}),o=d.find(".page-cur").text(t+1)),i.trigger("to.owl.carousel",[t]),l.hide(),s.show()}u.html(template("tplTabContentFamilyMembers",t));var i,o,l=u.find(".page-members"),s=u.find(".page-members-album"),r=l.find(".member-table"),c=l.find(".member-album"),d=s.find(".detail-album");r.jScrollPane(commonJSPConfig),c.on(C,"img",function(){a(+$(this).attr("data-index"))}).jScrollPane(commonJSPConfig),s.on(C,".btn-prev",function(t){i.trigger("prev.owl.carousel"),t.stopPropagation()}).on(C,".btn-next",function(){i.trigger("next.owl.carousel"),e.stopPropagation()}).on(C,".btn-back",function(){n()})};break;case N.CONDITION:a=URLS.URL_FAMILY_FILE_CONDITION,i=function(t){u.html(template("tplTabContentFamilyCondition",t))};break;case N.PLAN:a=URLS.URL_FAMILY_FILE_PLAN,i=function(t){u.html(template("tplTabContentFamilyPlan",t));var e=u.find(".sub-tabs"),n=u.find(".sub-tab-content").find("li"),a={};e.on(C,"li",function(){var t=$(this),e=t.attr("data-index");if(!t.hasClass(v)){t.addClass(v).siblings("li").removeClass(v);var i=n.eq(e);i.addClass(v).siblings("li").removeClass(v),a[e]||(a[e]=i.find(".content-wrapper").jScrollPane(commonJSPConfig).data("jsp"))}}),n.length>0&&(a[0]=n.filter("."+v).jScrollPane(commonJSPConfig).data("jsp"))};break;case N.IMPLEMENT:p({$pageTabContent:u,url:URLS.URL_FAMILY_FILE_IMPLEMENT,params:{id:t},success:function(t,e){function n(){r.hide(),s.show(),o()}function a(t){s.hide(),r.html(template("tplTabContentImplementAlbum",t)).show(),o()}var i=e.$subTogglesContent,o=e.refreshPageJSP;i.html(template("tplTabContentFamilyImplement",t));var l=t.table.list,s=i.find(".page-implement"),r=i.find(".page-implement-album");s.find(".table-wrapper").on(C,".ico-pic",function(){var t=$(this).attr("data-index");a(l[t])}),o(),r.on(C,".btn-back",function(){n()})}});break;case N.NEWS:a=URLS.URL_FAMILY_FILE_NEWS,i=function(e){l(t,u,e,URLS.URL_FAMILY_FILE_NEWS_DETAIL)};break;case N.INCOME:p({$pageTabContent:u,url:URLS.URL_FAMILY_FILE_INCOME,params:{id:t},success:function(e,n){function a(e){var n=e.year,a=e.month;E({url:URLS.URL_FAMILY_FILE_INCOME_TABLE,data:{id:t,year:n,month:a},success:function(t){var e=t.code,n=t.data;if(0==e&&n){r.html(template("tplTabContentFamilyIncomeTable",n));var a=r.find(".table-float-wrapper"),i=a.data("jsp");i||(i=a.jScrollPane(commonJSPConfig).data("jsp")),l(),i.reinitialise()}}})}var i=e.default_time,o=n.$subTogglesContent,l=n.refreshPageJSP;o.html(template("tplTabContentFamilyIncome",e));var s=o.find(".chart-section"),r=o.find(".table-section"),c=s.find(".chart"),d=echarts.init(c[0]);d.setOption(commonEchartConfig.genChartBarsConfig(e.chart_config_bar)),d.on(C,function(t){var e=t.name.split("."),n={};n.year=e[0],n.month=e[1],n&&a(n)}),i&&a(i),l()}});break;case N.ELIMINATE_PATH:p({$pageTabContent:u,url:URLS.URL_FAMILY_FILE_ELIMINATE_PATH,params:{id:t},success:function(e,n){o(t,n,e,URLS.URL_FAMILY_FILE_ELIMINATE_SCORES)}});break;case N.INVESTED:p({$pageTabContent:u,url:URLS.URL_FAMILY_FILE_INVESTED,params:{id:t},success:function(t,e){r(e,"tplTabContentFamilyInvested",t)}});break;case N.DATA_PATH:a=URLS.URL_FAMILY_FILE_DATA_PATH,i=function(t){s(u,t)};break;case N.BUSINESS:a=URLS.URL_FAMILY_FILE_BUSINESS,i=function(e){c(u,e,URLS.URL_FAMILY_FILE_BUSINESS_REST,t)}}a&&E({url:a,data:{id:t},success:function(t){var e=t.code,n=t.data;0==e&&n&&i(n)},error:function(){}})}}function i(t,e){var n,a,i=L.find(".page-tabs"),d=i.find("li."+v),f=L.find(".page-tab-content");if(d.attr("data-target")!=e){switch(i.find('li[data-target="'+e+'"]').addClass(v).siblings("li").removeClass(v),f.empty(),e){case M.STATUS:n=URLS.URL_COUNTRY_FILE_STATUS,a=function(t){f.html(template("tplCountryFileStatus",t))};break;case M.DEVELOPMENT_STATUS:n=URLS.URL_COUNTRY_FILE_DEVELOPMENT_STATUS,a=function(t){f.html(template("tplCountryFileDevelopmentStatus",t)),f.find(".content-wrapper").jScrollPane(commonJSPConfig)};break;case M.PLAN:n=URLS.URL_COUNTRY_FILE_PLAN,a=function(t){f.html(template("tplTabContentCountryPlan",t));var e=f.find(".sub-tabs"),n=f.find(".sub-tab-content").find("li"),a={};e.on(C,"li",function(){var t=$(this),e=t.attr("data-index");if(!t.hasClass(v)){t.addClass(v).siblings("li").removeClass(v);var i=n.eq(e);i.addClass(v).siblings("li").removeClass(v),a[e]||(a[e]=i.find(".content-wrapper").jScrollPane(commonJSPConfig).data("jsp"))}}),n.length>0&&(a[0]=n.filter("."+v).jScrollPane(commonJSPConfig).data("jsp"))};break;case M.IMPLEMENT:p({$pageTabContent:f,url:URLS.URL_COUNTRY_FILE_IMPLEMENT,params:{id:t},success:function(t,e){function n(){r.hide(),s.show(),o()}function a(t){s.hide(),r.html(template("tplTabContentImplementAlbum",t)).show(),o()}var i=e.$subTogglesContent,o=e.refreshPageJSP;i.html(template("tplTabContentCountryImplement",t));var l=t.table.list,s=i.find(".page-implement"),r=i.find(".page-implement-album");s.find(".table-wrapper").on(C,".ico-pic",function(){var t=$(this).attr("data-index");a(l[t])}),o(),r.on(C,".btn-back",function(){n()})}});break;case M.NEWS:n=URLS.URL_COUNTRY_FILE_NEWS,a=function(e){l(t,f,e,URLS.URL_COUNTRY_FILE_NEWS_DETAIL)};break;case M.MEETING_NEWS:n=URLS.URL_COUNTRY_FILE_MEETING_NEWS,a=function(e){l(t,f,e,URLS.URL_COUNTRY_FILE_MEETING_NEWS_DETAIL)};break;case M.ELIMINATE_PATH:p({$pageTabContent:f,url:URLS.URL_COUNTRY_FILE_ELIMINATE_PATH,params:{id:t},success:function(e,n){o(t,n,e,URLS.URL_COUNTRY_FILE_ELIMINATE_SCORES)}});break;case M.INVESTED:p({$pageTabContent:f,url:URLS.URL_COUNTRY_FILE_INVESTED,params:{id:t},success:function(t,e){r(e,"tplTabContentCountryInvested",t)}});break;case M.DATA_PATH:n=URLS.URL_COUNTRY_FILE_DATA_PATH,a=function(t){s(f,t)};break;case M.BUSINESS:n=URLS.URL_COUNTRY_FILE_BUSINESS,a=function(e){c(f,e,URLS.URL_COUNTRY_FILE_BUSINESS_REST,t)}}n&&E({url:n,data:{id:t},success:function(t){var e=t.code,n=t.data;0==e&&n&&a(n)},error:function(){}})}}function o(t,e,n,a){function i(e){d.empty(),l(),E({url:a,data:{id:t,year:e.year,month:e.month},success:function(t){var n=t.code,a=t.data;0==n&&a&&(d.html(template("tplTabContentFamilyEliminateScores",T({time:e},a))),l())},error:function(){}})}var o=e.$subTogglesContent,l=e.refreshPageJSP;o.html(template("tplTabContentEliminatePath",n));var s=n.default_time,r=n.chart_config,c=o.find(".chart"),d=o.find(".scores-section"),p=echarts.init(c[0]);p.setOption(commonEchartConfig.genChartBarsConfig(r)),p.on(C,function(t){var e=t.name.split("."),n={};n.year=e[0],n.month=e[1],n&&i(n)}),i(s)}function l(t,e,n,a){function i(){l.show(),s.hide()}function o(e){r.empty(),l.hide(),s.show(),E({url:a,data:{family_id:t,news_id:e},success:function(t){var e=t.code,n=t.data;if(0==e&&n){r.html(template("tplTabContentNewsDetail",n));var a=r.find(".content").jScrollPane(commonJSPConfig).data("jsp");r.find("img").on(I,function(){a.reinitialise()})}},error:function(){}})}e.html(template("tplTabContentNews",n));var l=e.find(".page-news"),s=e.find(".page-news-detail"),r=s.find(".content-wrapper");l.find(".content-wrapper").jScrollPane(commonJSPConfig),l.on(C,".item",function(){o($(this).attr("data-id"))}),s.on(C,".btn-back",function(){i()})}function s(t,e){t.html(template("tplTabContentDataPath",e)),t.find(".page-data-path").find(".content-wrapper").jScrollPane(commonJSPConfig)}function r(t,e,n){var a=t.$subTogglesContent,i=t.refreshPageJSP;a.html(template(e,n));var o=a.find(".table-float-wrapper").jScrollPane(commonJSPConfig).data("jsp");i(),o.reinitialise()}function c(t,e,n,a){t.html(template("tplTabContentBusiness",e));var i=t.find(".page-business").find(".content-wrapper"),o=i.jScrollPane(commonJSPConfig).data("jsp");i.on(C,".link-more",function(){function t(){e.removeClass(P)}var e=$(this),i=e.attr("data-type"),l=e.parent().find("ul.rest");e.hasClass(P)||(e.hasClass(R)?(l.addClass(U),e.removeClass(R),o.reinitialise()):(e.addClass(P),E({url:n,data:{type:i,id:a},success:function(n){var a=n.code,i=n.data;0==a&&(l.html(template("tplTabContentBusinessRest",i)).removeClass(U),e.addClass(R),o.reinitialise()),t()},error:function(){}})))})}function d(t,e,n){t.html(template("tplSubTogglesYear",e));var a=t.find(".sub-toggles-year"),i=t.find(".sub-toggles-content"),o=t.jScrollPane(commonJSPConfig).data("jsp");return a.on(C,"li",function(){var t=$(this);t.hasClass(v)||n&&(n(t.attr("data-value")),t.addClass(v).siblings("li").removeClass(v))}),{$subTogglesYear:a,$subTogglesContent:i,pageJSP:o,refreshPageJSP:function(){o.reinitialise()}}}function p(t){function e(s){s&&(i.year=s),E({url:t.url,data:i,success:function(t){var i=t.code,l=t.data;0==i&&l&&o&&(a||(a=d(n,l,e)),o(l,T({year:s},a)))},error:function(){l&&l()}})}var n,a,i=(t=T({},t)).params||{},o=t.success,l=t.error,s=t.$pageTabContent;n=s.html(template("tplTabContentSubTogglesYearWrap")).find(".toggles-content-wrapper"),e()}function f(t,e){b.find(".page-tabs").on(C,"li",function(){var e=$(this).attr("data-target");a(t,e)}),a(t,e)}function u(t,e){L.find(".page-tabs").on(C,"li",function(){var e=$(this).attr("data-target");i(t,e)}),i(t,e)}function m(){_.hide()}function h(){g.hide()}var _,g,L,b,T=$.extend,S=window.Helpers,E=S.ajax,C=($.monitorHelper.createDataMonitor,"click"),I="load",v="active",P="disabled",R="opened",U="hide",A=0,w=2,N={MEMBERS:"members",CONDITION:"condition",PLAN:"plan",IMPLEMENT:"implement",NEWS:"news",INCOME:"income",ELIMINATE_PATH:"eliminate_path",INVESTED:"invested",DATA_PATH:"data_path",BUSINESS:"business"},M={STATUS:"status",DEVELOPMENT_STATUS:"development_status",PLAN:"plan",IMPLEMENT:"implement",NEWS:"news",MEETING_NEWS:"meeting_news",ELIMINATE_PATH:"eliminate_path",INVESTED:"invested",DATA_PATH:"data_path",BUSINESS:"business"},F={SUCCESS:1},T=$.extend,E=function(t){t.complete;var e=t.success,n=t.error;showLoadingMask(),S.ajax(T({cache:!1},t,{success:function(){hideLoadingMask(),e&&e.apply(this,arguments)},error:function(){hideLoadingMask(),n&&n.apply(this,arguments)}}))},y=A;t(null,!0),$.poorFile={FAMILY_TARGETS:N,COUNTRY_TARGETS:M,showCountryFile:function(e,a){t(function(){_.show(),L.empty(),a||(a=M.STATUS),E({url:URLS.URL_COUNTRY_FILE_BASIC,data:{id:e},success:function(t){var i=t.code,o=t.data;0==i&&o&&(L.html(template("tplCountryFileBasic",o)),L.find(".tipso").each(function(){var t=$(this);t.tipso(T({},commonTipsoConfig,{content:t.attr("data-title")}))}),n(_),u(e,a))},error:function(){m()}})})},showFamilyFile:function(e,a){t(function(){g.show(),b.empty(),a||(a=N.MEMBERS),E({url:URLS.URL_FAMILY_FILE_BASIC,data:{id:e},success:function(t){var i=t.code,o=t.data;0==i&&o&&(b.html(template("tplFamilyFileBasic",T(o,{FAMILY_STAT:F}))),g.find(".tipso").each(function(){var t=$(this);t.tipso(T({},commonTipsoConfig,{content:t.attr("data-title")}))}),n(g),f(e,a))},error:function(){h()}})})},showFileDetail:function(t,e){function n(){l.on("click",".btn-close",function(t){l.hide()}),$("body").on("click",function(){var t=$(".select-box");t.removeClass("selected").find(".select-list").hide(),t.find(".arrow").removeClass("arrow-on")}),s.find(".js-select-box").on("click",function(){var t=$(this),e=t.find(".select-list"),n=t.parents(".select-area").find(".js-select-box").not(this);return t.toggleClass("selected"),e.toggle(),t.find(".arrow").toggleClass("arrow-on"),n.removeClass("selected").find(".select-list").hide(),n.find(".arrow").removeClass("arrow-on"),function(){var t=e.innerWidth(),n=e.innerHeight();t=t>120?120:t,e.find(".jspPane").length<1&&e.width(t),n>320&&e.jScrollPane(commonJSPConfig)}(),s.find(".download-select li").on("click",function(){var t=$(this).attr("data-download-url");S.showAlertDialog({content:"确认下载",btnPosText:"下载",btnPosCB:function(e){window.open(t),e.hide()}})}),!1})}function a(t){function e(t){showLoadingMask(),E({url:URLS.URL_DATA_MONITOR_CAPITAL_FILE_DETAIL_TABLE,data:T(o,{page:t.table_page}),success:function(n){var o=n.code,l=n.data;if(0==o&&l){var s={tableData:l.table,table_page:t.table_page};a.html(template("tplConfigTable",l.table)),i(),$.components.tableEvent.bindPopupEvent(a),t.tableData.pagination&&$.components.tableEvent.bindPagination(a,s,e)}hideLoadingMask()},error:function(){hideLoadingMask()}})}var n=Number($("#fileDetailFileName").attr("data-file-id")),a=$("#fileDetailTable"),o=T({id:n,page:1},t);showLoadingMask(),E({url:URLS.URL_DATA_MONITOR_CAPITAL_FILE_DETAIL_TABLE,data:o,success:function(t){var n=t.code,o=t.data;if(0==n&&o){a.html(template("tplConfigTable",o.table)),i();var l={tableData:o.table,table_page:1};$.components.tableEvent.bindPopupEvent(a),l.tableData.pagination&&$.components.tableEvent.bindPagination(a,l,e)}hideLoadingMask()},error:function(){hideLoadingMask()}})}function i(){var t=$("#popupFileDetailWrap"),e=t.find(".page-content-wrap"),n=t.find(".monitor-tb-wrap"),a=e.data("jsp"),i=n.data("jsp");i?i.reinitialise():i=n.jScrollPane(commonJSPConfig).data("jsp"),a?a.reinitialise():a=e.jScrollPane(commonJSPConfig).data("jsp"),i.reinitialise()}function o(t,e){t.html(template("tplDataMonitorTree"));var n=t.find(".tree-wrapper"),i=t.find(".tree-ul"),o=t.find(".ico-quest"),l=t.find(".tip"),s=t.data("jsp"),r=e.year,c=e.area_level,d=e.area_id,p=e.wintype,f=e.tabtype,u=(e.instance,e.file_id);s?s.reinitialise():s=n.jScrollPane(commonJSPConfig).data("jsp"),showLoadingMask(),E({url:URLS.URL_DATA_MONITOR_FILE_DETAIL_TREE,data:{year:r,level:c,id:d,wintype:p,tabtype:f,file_id:u},success:function(t){function e(t){if(t){var e=t.area_id;a({area_level:t.area_level,area_id:e})}}var n=t.code,c=t.data;if(0==n&&c){var d=c.tip,m=c.match_node_id,h=c.tree,_=$.fn.zTree.init(i,{async:{enable:!0,url:URLS.URL_DATA_MONITOR_FILE_DETAIL_TREE_SUBTREE,dataType:"json",type:"get",autoParam:["area_id=id","area_level=level"],otherParam:{year:r,wintype:p,tabtype:f,file_id:u},dataFilter:function(t,e,n){var a=n.code,i=n.data;return 0==a&&i?i:null}},view:{nameIsHTML:!0,showTitle:!1,showIcon:!1},callback:{onClick:function(t,n,a,i){e(a)},onExpand:function(){s.reinitialise()},onCollapse:function(){s.reinitialise()},onAsyncError:function(t,e,n){S.showCommonErrorDialog(function(){})}}},h),g=_.getNodeByParam("id",m);e(g),g&&(_.expandNode(g,!0,!1,!1,!0),_.selectNode(g)),l.html(d),o.show(),s.reinitialise()}else hideLoadingMask()},error:function(){hideLoadingMask()}})}var l=$("#popupFileDetailWrap"),s=l.find("#popupFileDetailTitle"),r=$("#fileDetaiMonitorTree"),c=t;showLoadingMask(),E({url:URLS.URL_DATA_MONITOR_CAPITAL_FILE_BASIC_INFO,data:{id:c},success:function(t){var a=t.code,i=t.data;if(i.file_id=c,i.file_name=e,0==a&&i){s.html(template("tplPopupFileDetailTitle",i)),l.show(),n();var d={year:"2017",area_level:i.area_level,area_id:i.area_id,wintype:"capital",tabtype:"capital_file_detail",file_id:c};o(r,d)}hideLoadingMask()},error:function(){hideLoadingMask()}})},showCountryPhoto:function(t,e){function n(t,e){var n=$("#popBigImgWrap"),a=$("#popBigImgWrap").find(".big-img-wrap");$("#popBigImgWrap").find(".big-img").attr("src",t),function(t,e){var n=new Image;n.src=t.src,n.onload=function(){var e=$(t).width();a.css("width",e)}}($("#popBigImgWrap").find(".big-img")[0]),a.find(".tips").text(e),n.show(),n.find(".btn-close").on("click",function(t){n.hide()})}function a(t){t.on("click",".btn-close",function(e){t.hide()}),t.on("click",".tab-list li",function(t){n($(this).attr("data-big-src"),$(this).find(".tips").text())}),$("body").on("click",function(){var t=$(".js-select-box");t.removeClass("selected").find(".select-list").hide(),t.find(".arrow").removeClass("arrow-on")}),t.find(".js-select-box").on("click",function(){var t=$(this),e=t.find(".select-list");return e.toggle(),t.find(".arrow").toggleClass("arrow-on"),e.innerWidth(),e.innerHeight()>320&&(console.log(e.length),e.jScrollPane(commonJSPConfig)),!1}),t.find(".js-select-box li").on("click",function(){var t=$(this).parents(".js-select-box").find(">span"),e=$(this).attr("data-id"),n=$(this).text();$(this).siblings().removeClass("active"),$(this).addClass("active"),t.text(n);var a=$(this).parents(".example-country-photo"),i=a.find(".photo-switch"),o=(i.find(".tab-list"),[]);if(""==e||null==e)o=s;else for(var l=0;l<s.length;l++){var r=s[l];r.belong_country_id==e&&o.push(r)}i.html(template("tplPhotoSwitch",{photo_list:o})),a.hasClass("fixed")?$.components.photoSwitch(i,2):$.components.photoSwitch(i,4)})}var i=$("#exampleCountryPhotoPopWrap"),o=$("#exampleCountryPhotoPop"),l=$("#exampleCountryPhoto"),s=[];showLoadingMask(),E({url:URLS.URL_DATA_EXAMPLE_COUNTRY_COUNTRY_PHOTO,data:{id:t},success:function(t){var n=t.code,r=t.data;s=r.photo_list,0==n&&r&&("pop"===e?(o.html(template("tplExampleCountryPhotoPop",r)),o.find(".photo-switch").html(template("tplPhotoSwitch",{photo_list:s})),i.show(),a(i),$.components.photoSwitch(o.find(".photo-switch"),4)):(l.html(template("tplExampleCountryPhoto",r)),l.find(".photo-switch").html(template("tplPhotoSwitch",{photo_list:s})),l.show(),a(l),$.components.photoSwitch(l.find(".photo-switch"),2))),hideLoadingMask()},error:function(){hideLoadingMask()}})},hideCountryPhoto:function(){$("#exampleCountryPhotoPop").hide()},hideFamilyFile:h}});