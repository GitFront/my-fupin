!function(t){var i=t.seriesTypes,e=t.merge,o=t.extend,l=t.extendClass,n=t.getOptions().plotOptions,r=function(){},s=t.each,a=HighchartsAdapter.grep,h=t.pick,d=t.Series,c=t.Color;n.treemap=e(n.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.node.val}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:i.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}});var p={pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",dashstyle:"borderDashStyle"},pointArrayMap:["value"],axisTypes:i.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:r,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:i.heatmap&&i.heatmap.prototype.translateColors};i.treemap=l(i.scatter,e(p,{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:l(t.Point,{setState:function(i,e){t.Point.prototype.setState.call(this,i,e),"hover"===i?this.dataLabel&&this.dataLabel.attr({zIndex:1002}):this.dataLabel&&this.dataLabel.attr({zIndex:this.pointAttr[""].zIndex+1})},setVisible:i.pie.prototype.pointClass.prototype.setVisible}),handleLayout:function(){var t,i=this.tree;this.points.length&&(this.rootNode=h(this.rootNode,""),i=this.tree=this.getTree(),this.levelMap=this.getLevels(),t=this.getSeriesArea(i.val),this.calculateChildrenAreas(i,t),this.setPointValues())},getTree:function(){var t,i,e=this,o=[],l=[];this.nodeMap=[],s(this.points,function(t,i){var e="";l.push(t.id),void 0!==t.parent&&(e=t.parent),void 0===o[e]&&(o[e]=[]),o[e].push(i)});for(i in o)o.hasOwnProperty(i)&&""!==i&&-1===HighchartsAdapter.inArray(i,l)&&(!function(t){s(o[t],function(t){o[""].push(t)})}(i),delete o[i]);return t=e.buildNode("",-1,0,o,null),this.eachParents(this.nodeMap[this.rootNode],function(t){t.visible=!0}),this.eachChildren(this.nodeMap[this.rootNode],function(t){t.visible=!0}),this.setTreeValues(t),t},buildNode:function(t,i,e,o,l){var n,r,a=this,h=[],d=a.points[i];return s(o[t]||[],function(i){r=a.buildNode(a.points[i].id,i,e+1,o,t),h.push(r)}),n={id:t,i:i,children:h,level:e,parent:l,visible:!1},a.nodeMap[n.id]=n,d&&(d.node=n),n},setTreeValues:function(t){var i,e=this,l=0,n=[],r=e.points[t.i];return s(t.children,function(t){t=e.setTreeValues(t),e.insertElementSorted(n,t,function(t,i){return t.val>i.val}),t.ignore?e.eachChildren(t,function(t){o(t,{ignore:!0,isLeaf:!1,visible:!1})}):l+=t.val}),i=h(r&&r.value,l),o(t,{children:n,childrenTotal:l,ignore:!(h(r&&r.visible,!0)&&i>0),isLeaf:t.visible&&!l,name:h(r&&r.name,""),val:i}),t},eachChildren:function(t,i){var e=this,o=t.children;i(t),o.length&&s(o,function(t){e.eachChildren(t,i)})},eachParents:function(t,i){var e=this.nodeMap[t.parent];i(t),e&&this.eachParents(e,i)},calculateChildrenAreas:function(t,i){var o,l,n=this,r=n.options,d=r.levelIsConstant?t.level:t.level-this.nodeMap[this.rootNode].level,c=this.levelMap[d+1],p=h(n[c&&c.layoutAlgorithm]&&c.layoutAlgorithm,r.layoutAlgorithm),u=r.alternateStartingDirection,f=[];o=a(t.children,function(t){return!t.ignore}),c&&c.layoutStartingDirection&&(i.direction="vertical"===c.layoutStartingDirection?0:1),f=n[p](i,o),s(o,function(t,o){(l=n.points[t.i]).level=d+1,t.values=e(f[o],{val:t.childrenTotal,direction:u?1-i.direction:i.direction}),t.children.length&&n.calculateChildrenAreas(t,t.values)})},setPointValues:function(){var t=this,i=t.xAxis,e=t.yAxis;t.nodeMap[""].values={x:0,y:0,width:100,height:100},s(t.points,function(o){var l,n,r,s,a=o.node.values;a?(a.x=a.x/t.axisRatio,a.width=a.width/t.axisRatio,l=Math.round(i.translate(a.x,0,0,0,1)),n=Math.round(i.translate(a.x+a.width,0,0,0,1)),r=Math.round(e.translate(a.y,0,0,0,1)),s=Math.round(e.translate(a.y+a.height,0,0,0,1)),o.shapeType="rect",o.shapeArgs={x:Math.min(l,n),y:Math.min(r,s),width:Math.abs(n-l),height:Math.abs(s-r)},o.plotX=o.shapeArgs.x+o.shapeArgs.width/2,o.plotY=o.shapeArgs.y+o.shapeArgs.height/2):(delete o.plotX,delete o.plotY)})},getSeriesArea:function(t){var i={x:0,y:0,width:100*(this.axisRatio=this.xAxis.len/this.yAxis.len),height:100,direction:"vertical"===this.options.layoutStartingDirection?0:1,val:t};return this.nodeMap[""].values=i,i},getLevels:function(){var t=[],i=this.options.levels;return i&&s(i,function(i){void 0!==i.level&&(t[i.level]=i)}),t},setColorRecursive:function(t,i){var e,o,l=this;t&&(e=l.points[t.i],o=l.levelMap[t.level],i=h(e&&e.options.color,o&&o.color,i),e&&(e.color=i),t.children.length&&s(t.children,function(t){l.setColorRecursive(t,i)}))},alg_func_group:function(t,i,e,o){this.height=t,this.width=i,this.plot=o,this.direction=e,this.startDirection=e,this.total=0,this.nW=0,this.lW=0,this.nH=0,this.lH=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(t,i){return Math.max(t/i,i/t)}},this.addElement=function(t){this.lP.total=this.elArr[this.elArr.length-1],this.total=this.total+t,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(t)},this.reset=function(){this.nW=0,this.lW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(t,i,e,o){var l,n,r,a,h,d=e.lW,c=e.lH,p=e.plot,u=0,f=e.elArr.length-1;i?(d=e.nW,c=e.nH):h=e.elArr[e.elArr.length-1],s(e.elArr,function(t){(i||u<f)&&(0===e.direction?(l=p.x,n=p.y,a=t/(r=d)):(l=p.x,n=p.y,r=t/(a=c)),o.push({x:l,y:n,width:r,height:a}),0===e.direction?p.y=p.y+a:p.x=p.x+r),u+=1}),e.reset(),0===e.direction?e.width=e.width-d:e.height=e.height-c,p.y=p.parent.y+(p.parent.height-e.height),p.x=p.parent.x+(p.parent.width-e.width),t&&(e.direction=1-e.direction),i||e.addElement(h)},alg_func_lowAspectRatio:function(t,i,e){var o,l=[],n=this,r={x:i.x,y:i.y,parent:i},a=i.direction,h=0,d=e.length-1,c=new this.alg_func_group(i.height,i.width,a,r);return s(e,function(e){o=i.width*i.height*(e.val/i.val),c.addElement(o),c.lP.nR>c.lP.lR&&n.alg_func_calcPoints(t,!1,c,l,r),h===d&&n.alg_func_calcPoints(t,!0,c,l,r),h+=1}),l},alg_func_fill:function(t,i,e){var o,l,n,r,a,h=[],d=i.direction,c=i.x,p=i.y,u=i.width,f=i.height;return s(e,function(e){o=i.width*i.height*(e.val/i.val),l=c,n=p,0===d?(u-=r=o/(a=f),c+=r):(f-=a=o/(r=u),p+=a),h.push({x:l,y:n,width:r,height:a}),t&&(d=1-d)}),h},strip:function(t,i){return this.alg_func_lowAspectRatio(!1,t,i)},squarified:function(t,i){return this.alg_func_lowAspectRatio(!0,t,i)},sliceAndDice:function(t,i){return this.alg_func_fill(!0,t,i)},stripes:function(t,i){return this.alg_func_fill(!1,t,i)},translate:function(){d.prototype.translate.call(this),this.handleLayout(),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0)},drawDataLabels:function(){var t,i,o=this,l=o.dataLabelsGroup,n=o.points;s(n,function(l){i=o.levelMap[l.level],t={style:{}},l.node.isLeaf||(t.enabled=!1),i&&i.dataLabels&&(t=e(t,i.dataLabels),o._hasPointLabels=!0),l.shapeArgs&&(t.style.width=l.shapeArgs.width),l.dlOptions=e(t,l.options.dataLabels)}),this.dataLabelsGroup=this.group,d.prototype.drawDataLabels.call(this),this.dataLabelsGroup=l},alignDataLabel:i.column.prototype.alignDataLabel,drawPoints:function(){var o,l,n,r=this,a=r.points,d=r.options;s(a,function(i){n=r.levelMap[i.level],o={stroke:d.borderColor,"stroke-width":d.borderWidth,dashstyle:d.borderDashStyle,r:0,fill:h(i.color,r.color)},n&&(o.stroke=n.borderColor||o.stroke,o["stroke-width"]=n.borderWidth||o["stroke-width"],o.dashstyle=n.borderDashStyle||o.dashstyle),o.stroke=i.borderColor||o.stroke,o["stroke-width"]=i.borderWidth||o["stroke-width"],o.dashstyle=i.borderDashStyle||o.dashstyle,o.zIndex=1e3-2*i.level,i.pointAttr=e(i.pointAttr),(l=i.pointAttr.hover).zIndex=1001,l.fill=c(o.fill).brighten(d.states.hover.brightness).get(),i.node.isLeaf||(h(d.interactByLeaf,!d.allowDrillToNode)?(o.fill="none",delete l.fill):(o.fill=c(o.fill).setOpacity(.15).get(),l.fill=c(l.fill).setOpacity(.75).get())),i.node.level<=r.nodeMap[r.rootNode].level&&(o.fill="none",o.zIndex=0,delete l.fill),i.pointAttr[""]=t.extend(i.pointAttr[""],o),i.dataLabel&&i.dataLabel.attr({zIndex:i.pointAttr[""].zIndex+1})}),i.column.prototype.drawPoints.call(this),s(a,function(t){t.graphic&&t.graphic.attr(t.pointAttr[""])}),d.allowDrillToNode&&r.drillTo()},insertElementSorted:function(t,i,e){var o=0,l=!1;0!==t.length&&s(t,function(n){e(i,n)&&!l&&(t.splice(o,0,i),l=!0),o+=1}),l||t.push(i)},drillTo:function(){var i=this,e=i.points;s(e,function(e){var o,l;t.removeEvent(e,"click.drillTo"),e.graphic&&e.graphic.css({cursor:"default"}),(o=i.options.interactByLeaf?i.drillToByLeaf(e):i.drillToByGroup(e))&&(l=i.nodeMap[i.rootNode].name||i.rootNode,e.graphic&&e.graphic.css({cursor:"pointer"}),t.addEvent(e,"click.drillTo",function(){e.setState(""),i.drillToNode(o),i.showDrillUpButton(l)}))})},drillToByGroup:function(t){var i=this,e=!1;return t.node.level-i.nodeMap[i.rootNode].level!=1||t.node.isLeaf||(e=t.id),e},drillToByLeaf:function(t){var i,e=this,o=!1;if(t.node.parent!==e.rootNode&&t.node.isLeaf)for(i=t.node;!o;)(i=e.nodeMap[i.parent]).parent===e.rootNode&&(o=i.id);return o},drillUp:function(){var t,i,e=null;this.rootNode&&(e=null!==(t=this.nodeMap[this.rootNode]).parent?this.nodeMap[t.parent]:this.nodeMap[""]),null!==e&&(this.drillToNode(e.id),""===e.id?this.drillUpButton=this.drillUpButton.destroy():(i=this.nodeMap[e.parent],this.showDrillUpButton(i.name||i.id)))},drillToNode:function(t){var i=this.nodeMap[t].values;this.rootNode=t,this.xAxis.setExtremes(i.x,i.x+i.width,!1),this.yAxis.setExtremes(i.y,i.y+i.height,!1),this.isDirty=!0,this.chart.redraw()},showDrillUpButton:function(t){var i,e,o=this,l=t||"< Back",n=o.options.drillUpButton;n.text&&(l=n.text),this.drillUpButton?this.drillUpButton.attr({text:l}).align():(e=(i=n.theme)&&i.states,this.drillUpButton=this.chart.renderer.button(l,null,null,function(){o.drillUp()},i,e&&e.hover,e&&e.select).attr({align:n.position.align,zIndex:9}).add().align(n.position,!1,n.relativeTo||"plotBox"))},buildKDTree:r,drawLegendSymbol:t.LegendSymbolMixin.drawRectangle,getExtremes:function(){d.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,d.prototype.getExtremes.call(this)},getExtremesFromAll:!0,bindAxes:function(){var i={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};d.prototype.bindAxes.call(this),t.extend(this.yAxis.options,i),t.extend(this.xAxis.options,i)}}))}(Highcharts);