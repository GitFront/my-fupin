$.namespace("common.report"),common.report.page={reportmap:{},seach_form_id:"",seachid:"head-search",gridId:"",expotTitle:"",init:function(e,o,r){this.seach_form_id=e,this.gridId=o,this.expotTitle=r,$("#hc-report-btn-search").linkbutton("options")&&$("#hc-report-btn-search").linkbutton("options").disabled&&($("#hc-report-btn-search").linkbutton("enable"),$("#hc-report-btn-search").bind("click",this.reload)),$("#hc-report-btn-reset").length>0&&$("#hc-report-btn-reset").linkbutton("options").disabled&&($("#hc-report-btn-reset").linkbutton("enable"),$("#hc-report-btn-reset").bind("click",this.reset)),$("#hc-report-btn-export").length>0&&$("#hc-report-btn-export").linkbutton("options").disabled&&($("#hc-report-btn-export").linkbutton("enable"),$("#hc-report-btn-export").bind("click",this.download))},load:{Pie:function(e,o,r,t,a,m){var n=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),p=Highchart.mybatis.Pie(e,o,n,t,a,m);common.report.page.reportmap[e]=p},Line:function(e,o,r,t,a,m,n){var p=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),i=Highchart.mybatis.Line(e,o,p,t,a,m,n);common.report.page.reportmap[e]=i},InvertedLine:function(e,o,r,t,a,m){var n=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),p=Highchart.mybatis.InvertedLine(e,o,n,t,a,m);common.report.page.reportmap[e]=p},Bars:function(e,o,r,t,a,m,n){var p=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),i=Highchart.mybatis.Bars(e,o,p,t,a,m,n);common.report.page.reportmap[e]=i},StackBars:function(e,o,r,t,a,m,n){var p=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),i=Highchart.mybatis.StackBars(e,o,p,t,a,m,n);common.report.page.reportmap[e]=i},TimeSeriesLine:function(e,o,r,t,a,m,n){var p=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),i=Highchart.mybatis.TimeSeriesLine(e,o,p,t,a,m,n);common.report.page.reportmap[e]=i},Gauge:function(e,o,r,t,a,m){var n=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),p=Highchart.mybatis.Gauge(e,o,n,t,a,m);common.report.page.reportmap[e]=p},Grid:function(e,o,r,t,a){var m=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),n={};n.queryName=o,n.param=common.utils.strToJson(m),n.isPage=t;var p=ctx+"/a/report/grid/load",i=$("#"+e);if(common.utils.isDefined(a)&&a){var c=$(window).height()-55-93,s=common.utils.getGridPage(c);i.datagrid({height:c,pageSize:s,pageList:[10,15,20,25,30,35,40,45,50],url:p,queryParams:n})}else i.datagrid({url:p,queryParams:n});var l={};l.chart=i,l.chartType="Grid",l.url=p,l.parameters=n;var u=common.report.highcharts.object.add(l);common.report.page.reportmap[e]=u},InfoTable:function(e,o,r,t){var a=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),m={};m.queryName=o,m.param=common.utils.strToJson(a),m.mapper=common.utils.strToJson(t);var n=ctx+"/a/report/infotable/load";$.ajax({type:"POST",url:n,data:m,cache:!0,dataType:"json",success:function(o){common.report.page.utils.loadInfoData(e,o);var r={};r.chart=e,r.chartType="InfoTable",r.data=o,r.url=n,r.parameters=m;var t=common.report.highcharts.object.add(r);common.report.page.reportmap[e]=t}})},Map:function(e,o,r,t,a,m,n){var p=common.report.page.utils.getDefauleParams(common.report.page.seachid,r),i=Highmap.mybatis.Map(e,o,p,t,a,m,n);common.report.page.reportmap[e]=i}},reload:function(e,o,r,t,a){if(!common.utils.isString(e)||common.utils.isEmpty(e))common.report.page.utils.reloadAll();else{if(!common.report.page.reportmap.hasOwnProperty(e))return;var m=common.report.page.reportmap[e],n=common.report.highcharts.object.get(m),p=n.chartType,i=n.parameters;common.utils.isEmpty(o)&&(o=i.queryName),common.utils.isEmpty(r)&&(r=i.param),common.utils.isEmpty(t)&&(t=i.mapper);var c=common.report.page.utils.getQueryParams(common.report.page.seachid,r);switch(p){case"InfoTable":common.report.page.utils.reloadInfoTable(e,o,c,t);break;case"Grid":common.report.page.utils.reloadGrid(e,o,c);break;case"Map":Highmap.mybatis.reload(m,o,c,t,a);break;default:Highchart.mybatis.reload(m,o,c,t,a)}}},reset:function(){$("#"+common.report.page.seach_form_id).form("clear")},download:function(){exportExcel(common.report.page.gridId,common.report.page.expotTitle)},utils:{getQueryParams:function(e,o){common.utils.strToJson(o);var r={};return $("#"+e).find(":input").each(function(){var e=$(this).attr("name"),o=$(this).val();null!=o&&(o=Common.delHtml(o)),null!=e&&void 0!=e&&(r.hasOwnProperty(e)?r[e]+="|"+o:r[e]=o)}),$.extend({},o,r)},getDefauleParams:function(e,o){common.utils.strToJson(o);var r={};return $("#"+e).find(":input").each(function(){var e=$(this).attr("name"),o=$(this).val();null!=o&&(o=Common.delHtml(o)),null!=e&&void 0!=e&&(r.hasOwnProperty(e)?r[e]+="|"+o:r[e]=o)}),$.extend({},r,o)},reloadInfoTable:function(e,o,r,t){if(common.utils.isString(e)&&!common.utils.isEmpty(e)){var a=common.report.page.reportmap[e],m=common.report.highcharts.object.get(a),n=m.url,p={};p.queryName=o,p.param=common.utils.strToJson(r),p.mapper=common.utils.strToJson(t),$.ajax({type:"POST",url:n,data:p,cache:!0,dataType:"json",success:function(r){common.report.page.utils.loadInfoData(e,r),m.data=r,m.queryName=o,m.parameters=p,common.report.highcharts.object.reset(a,m)}})}},reloadGrid:function(e,o,r){if(common.utils.isString(e)&&!common.utils.isEmpty(e)){var t=common.report.page.reportmap[e],a=common.report.highcharts.object.get(t),m=a.chart,n=a.parameters;n.queryName=o,n.param=common.utils.strToJson(r),m.datagrid("load",n),a.parameters=n,common.report.highcharts.object.reset(t,a)}},loadInfoData:function(e,o){common.utils.isEmpty(o)||$("#"+e+" span").each(function(){var e=$(this).attr("id");o.hasOwnProperty(e)?$(this).text(o[e]):common.utils.isEmpty(e)||$(this).text("-")})},reloadAll:function(){for(var e in common.report.page.reportmap)common.utils.isEmpty(e)||common.report.page.reload(e)}}};