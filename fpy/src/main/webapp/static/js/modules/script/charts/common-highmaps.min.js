$.namespace("common.report.highcharts"),Array.prototype.contains=function(a){for(var o=this.length;o--;)if(this[o]===a)return!0;return!1},Highcharts.setOptions({lang:{drillUpText:"返回 > {series.name}"}});var Highmap={mapid:"",levelid:"",level:{id:"",name:"",point:{},geojson:{}},levarray:new Array,mapValue:{},mapKey:"PAC",parentKey:"parentKey",drillKey:"drillKey",pointFormat:void 0,ajaxPoint:!1,mapObject:{},setLoading:[],valueType:"map",isLayerLoad:!1,loadParameter:{},valueSource:"Static",authInfo:{},fontFamily:"",topMapNode:"",topMapJson:{},loadMapGeoUrl:"/a/report/highmaps/mapGeo/load",loadPointGeoUrl:"/a/report/highmaps/pointGeo/load",ChartDataFormate:{FormatGeoData:function(a,o){var e=new Array;return common.utils.isDefined(o)&&common.utils.isArray(o)&&0!==o.length?($.each(a,function(a){this.drilldown=this.properties[Highmap.drillKey];for(var t=0;t<o.length;t++){var i=o[t];if(this.properties[Highmap.mapKey]===i[Highmap.mapKey]){e.push(i);break}}}),e):($.each(a,function(a){this.drilldown=this.properties[Highmap.drillKey]}),e)},FormatLevelSeries:function(a,o){a.data=o},FormatGroupData:function(a){common.utils.isArray(a)||(a=[]);for(var o=new Array,e=new Array,t=new Array,i=0;i<a.length;i++)o.contains(a[i].name)||o.push(a[i].name),e.contains(a[i].group)||e.push(a[i].group);for(i=0;i<e.length;i++){var r={},p=e[i],l=!0;e[i].endsWith("|hide")&&(l=!1,p=e[i].replace("|hide",""));for(var n=new Array,m=0;m<a.length;m++)for(var s=0;s<o.length;s++)e[i]==a[m].group&&a[m].name==o[s]&&n.push(a[m].value);r={name:p,data:n,visible:l},t.push(r)}return{category:o,series:t}},FormatMapData:function(a){var o={},e=new Array,t=Highmap.valueType;return $.each(a,function(a){var i=this;if("mapbubble"!==t||i.hasOwnProperty("z")||(i.z=i.value),i.hasOwnProperty(Highmap.parentKey)&&i[Highmap.parentKey]===Highmap.topMapNode||!i.hasOwnProperty(Highmap.parentKey))e.push(i);else{var r=i[Highmap.parentKey];o.hasOwnProperty(r)?o[r].push(i):(o[r]=new Array,o[r].push(i))}}),o[Highmap.topMapNode]=e,o}},MapOptionTemplates:{Map:function(container,data,mapData,joinBy,opt,callback){function doOption(series){var option={chart:{height:opt.height,backgroundColor:opt.color.backgroundColor,borderColor:opt.color.borderColor,borderRadius:0,borderWidth:1,renderTo:container,events:{drilldown:function(e){if(!e.seriesOptions){var pointinfo=e.point,cname=pointinfo.properties.name,key=pointinfo.properties[Highmap.mapKey];Highmap.levelid=key,Highmap.level={id:key,name:cname},Highmap.levarray.push(Highmap.level);var data=Highmap.mapValue;if(Highmap.isLayerLoad&&"Ajax"===Highmap.valueSource){var url=Highmap.loadParameter.url,parameter=Highmap.loadParameter.parameters;parameter.map_pac=key,parameter.map_level=Highmap.utils.getMapLevel(key);for(var map_pac_level="",index=0;index<Highmap.levarray.length;index++)0===index?map_pac_level=Highmap.levarray[index].id:map_pac_level+=","+Highmap.levarray[index].id;parameter.map_pac_level=map_pac_level,Highmap.utils.loadAuthParameters(parameter),$.ajax({type:"GET",url:url,data:parameter,contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:function(a){var o=Highmap.ChartDataFormate.FormatMapData(a);Highmap.utils.mapDrilldown(pointinfo,o[key],opt)}})}else{var dmv_=Highmap.ChartDataFormate.FormatMapData(Highmap.mapValue);Highmap.utils.mapDrilldown(pointinfo,dmv_[key],opt)}opt.title&&Highmap.mapObject.setTitle(null,{text:cname});var funcName=opt.doDrilldown;if(common.utils.isFunction(funcName)){var lvl=Highmap.utils.getMapLevel(key);eval(funcName+"(e.point,key,lvl)")}}},drillup:function(e){if(common.utils.isDefined(this.subtitle)&&this.setTitle(null,{text:e.seriesOptions.name}),Highmap.level.point.enable){for(var delDex=new Array,index=0;index<Highmap.mapObject.series.length;index++)for(var ids=Highmap.level.point.ids,y=0;y<Highmap.level.point.num;y++)Highmap.mapObject.series[index].userOptions.id!==ids[y]||delDex.push(index);for(var index=delDex.length-1;index>=0;index--)Highmap.mapObject.series[delDex[index]].remove(!1)}Highmap.levarray.pop(),Highmap.levelid=Highmap.levarray[Highmap.levarray.length-1].id,Highmap.level=Highmap.levarray[Highmap.levarray.length-1];var funcName=opt.doDrillup;if(common.utils.isFunction(funcName)){var lvl=Highmap.utils.getMapLevel(Highmap.levelid);eval(funcName+"(Highmap.levelid,lvl)")}}}},title:{text:""},credits:{enabled:!1},subtitle:{text:"",floating:!0,align:"right",y:50,style:{fontFamily:Highmap.fontFamily,fontSize:"16px"}},legend:opt.legend,colorAxis:{min:0,stops:opt.colorStops},tooltip:{backgroundColor:opt.color.tooltipBackgroundColor,borderColor:opt.color.tooltipBorderColor,borderWidth:1,borderRadius:1},loading:{labelStyle:{fontFamily:Highmap.fontFamily,fontWeight:"bold",position:"relative",top:"45%"},showDuration:10,style:{position:"absolute",backgroundColor:"#c1c1c1",opacity:.2,textAlign:"center"}},exporting:{enabled:!1},colors:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,void 0],[1,Highcharts.Color(void 0).brighten(-.3).get("rgb")]]},mapNavigation:{enabled:opt.navigation,enableButtons:opt.navigationButton},plotOptions:{series:{cursor:opt.cursor,events:{click:function(e){if(!e.seriesOptions){var funcName=opt.doClick;if(common.utils.isFunction(funcName)){var lvl=Highmap.utils.getMapLevel(Highmap.levelid);eval(funcName+"(e.point,Highmap.levelid,lvl)")}}}}}},series:series,drilldown:{activeDataLabelStyle:{color:"#FFFFFF",textDecoration:"none",textShadow:"0 0 3px #000000"},animation:!0,drillUpButton:{relativeTo:opt.drillUpButton.relativeTo,position:{y:opt.drillUpButton.y,x:opt.drillUpButton.x},theme:{fill:opt.drillUpButton.fill,"stroke-width":opt.drillUpButton.strokeWidth,stroke:opt.drillUpButton.stroke,r:opt.drillUpButton.r,style:{color:opt.drillUpButton.fontColor,fontFamily:Highmap.fontFamily,fontSize:opt.drillUpButton.fontSize,cursor:"pointer"},states:{hover:{fill:opt.drillUpButton.selectColor},select:{stroke:"#039",fill:opt.drillUpButton.selectColor}}}}}};eval("callback(option)")}Highmap.topMapNode=opt.topNode,Highmap.mapValue=data,Highmap.fontFamily=opt.fontFamily,Highmap.valueType=opt.valueType,Highmap.mapKey=joinBy,Highmap.parentKey=opt.parentKey,Highmap.isLayerLoad=opt.isLayerLoad,Highmap.drillKey=opt.drillKey,Highmap.authInfo=opt.authInfo,Highmap.setLoading=opt.setLoading;var mapValue_=Highmap.ChartDataFormate.FormatMapData(data);Highmap.pointFormat=Highmap.utils.convValueFormat(opt),Highmap.utils.createMapSeries(opt.mapName,mapValue_[Highmap.topMapNode],mapData,joinBy,opt,doOption)}},create:{init:function(container,data,mapData,joinBy,option,isNotLoading,callback){function initMap(opt){Highmap.mapObject=new Highcharts.Map(opt),Highmap.levelid=Highmap.topMapNode;var pointInfo=Highmap.utils.loadMappoint(option_,Highmap.topMapNode,Highmap.utils.getMapLevel(Highmap.topMapNode));Highmap.level={id:Highmap.topMapNode,name:option_.mapName,point:pointInfo,geojson:Highmap.topMapJson},Highmap.levarray.push(Highmap.level),option_.title&&Highmap.mapObject.setTitle(null,{text:option_.mapName});var obj={chart:Highmap.mapObject,chartType:type,option:option_,data:data,mapData:mapData,joinBy:joinBy};Highmap.mapid=common.report.highcharts.object.add(obj),isNotLoading||Highmap.utils.mapHideLoading(),common.utils.isFunction(callback)&&eval("callback()")}isNotLoading||Highmap.utils.mapShowLoading(),"Static"===Highmap.valueSource&&(option.isLayerLoad=!1);var type="Map",option_=Highmap.utils.defaultOption(option);option_.container=container,option_.optionType=type,eval("Highmap.MapOptionTemplates."+type+"(container,data,mapData,joinBy,option_,initMap)")}},reloadData:function(a,o,e,t,i){var r=common.report.highcharts.object.get(a);if(null!=r){var p=r.chart;i||Highmap.utils.mapShowLoading();var l=r.option;common.utils.isDefined(o)||(o=r.data),common.utils.isDefined(e)?l.valueMapper=e:e=l.valueMapper,Highmap.mapValue=o;var n=Highmap.ChartDataFormate.FormatMapData(o),m=Highmap.ChartDataFormate.FormatGeoData(Highmap.level.geojson,n[Highmap.levelid]);Highmap.pointFormat=Highmap.utils.convValueFormat(l);for(c=0;c<p.series.length;c++)"map"===p.series[c].userOptions.type&&(1===Highmap.levarray.length?p.series[c].update({data:m},!1):p.series[c].setData(m,!1));if(common.utils.isDefined(p.drilldownLevels))for(var s=p.drilldownLevels,c=0;c<s.length;c++)Highmap.ChartDataFormate.FormatLevelSeries(p.drilldownLevels[s.length-1-c].series,n[Highmap.levarray[Highmap.levarray.length-(2+c)].id]);t&&common.utils.isArray(t)&&(p.colorAxis[0].update({stops:Highmap.utils.convColorstops(t)},!0),l.colorStops=t),r.chart=p,r.data=o,r.option=l,common.report.highcharts.object.reset(a,r),p.redraw(!0),i||Highmap.utils.mapHideLoading()}},reload:function(chartid,data,newOption,isNotLoading){function reloadMap(a){isNotLoading||Highmap.utils.mapHideLoading(),chart.destroy(),chart=new Highcharts.Map(a),Highmap.mapObject=chart,obj.chart=chart,obj.option=opt,obj.data=data,common.report.highcharts.object.reset(chartid,obj)}var obj=common.report.highcharts.object.get(chartid);if(null!=obj){var chart=obj.chart;isNotLoading||Highmap.utils.mapShowLoading();var opt=obj.option,mapData=obj.mapData,joinBy=obj.joinBy,container=opt.container,type=opt.optionType;return common.utils.isDefined(data)||(data=obj.data),common.utils.isDefined(newOption)&&(opt=Highmap.utils.defaultOption(newOption),opt.container=container,opt.optionType=type),eval("Highmap.MapOptionTemplates."+type+"(container,data,mapData,joinBy,opt,reloadMap)"),!0}return!1},remove:function(a){return!!common.report.highcharts.object.containsKey(a)&&(common.report.highcharts.object.get(a).chart.destroy(),common.report.highcharts.object.remove(a),!0)},ajax:{init:function(a,o,e,t,i,r){Highmap.valueSource="Ajax",Highmap.create.init(a,[],t,i,r,!0,function(){var a=common.report.highcharts.object.get(Highmap.mapid);a.chart;Highmap.utils.mapShowLoading(),e=common.utils.strToJson(e),Highmap.utils.loadAuthParameters(e,r.authInfo),r.isLayerLoad&&(Highmap.loadParameter={url:o,parameters:e},e.map_pac=Highmap.topMapNode,e.map_level=Highmap.utils.getMapLevel(Highmap.topMapNode),e.map_pac_level=Highmap.topMapNode),$.ajax({type:"POST",url:o,data:e,cache:!0,dataType:"json",success:function(t){Highmap.reloadData(Highmap.mapid,t,void 0,void 0,!0),Highmap.utils.mapHideLoading(),(a=common.report.highcharts.object.get(Highmap.mapid)).url=o,a.parameters=e,common.report.highcharts.object.reset(Highmap.mapid,a)}})})},reload:function(a,o,e,t){var i=common.report.highcharts.object.get(a);if(null==i)return!1;if(common.utils.isEmpty(o)){var r=i.data;return Highmap.reload(a,r,t)}i.chart;Highmap.utils.mapShowLoading(),common.utils.isEmpty(o)&&(o=i.url),common.utils.isEmpty(e)&&(e=i.parameters),e=common.utils.strToJson(e),Highmap.utils.loadAuthParameters(e,t.authInfo),t.isLayerLoad&&(Highmap.loadParameter={url:o,parameters:e},e.map_pac=Highmap.topMapNode,e.map_level=Highmap.utils.getMapLevel(Highmap.topMapNode),e.map_pac_level=Highmap.topMapNode),$.ajax({type:"POST",url:o,data:e,cache:!0,dataType:"json",success:function(r){return Highmap.reload(a,r,t,!0),Highmap.utils.mapHideLoading(),i=common.report.highcharts.object.get(a),i.url=o,i.parameters=e,common.report.highcharts.object.reset(a,i),!0}})},reloadData:function(a,o,e,t,i){var r=common.report.highcharts.object.get(a);if(null==r)return!1;if(!common.utils.isEmpty(o)){r.chart;if(Highmap.utils.mapShowLoading(),common.utils.isEmpty(o)&&(o=r.url),common.utils.isEmpty(e)&&(e=r.parameters),e=common.utils.strToJson(e),Highmap.utils.loadAuthParameters(e),Highmap.isLayerLoad){Highmap.loadParameter={url:o,parameters:e},e.map_pac=Highmap.levelid,e.map_level=Highmap.utils.getMapLevel(Highmap.levelid);for(var p="",l=0;l<Highmap.levarray.length;l++)0===l?p=Highmap.levarray[l].id:p+=","+Highmap.levarray[l].id;e.map_pac_level=p}$.ajax({type:"POST",url:o,data:e,cache:!0,dataType:"json",success:function(p){return Highmap.reloadData(a,p,t,i,!0),Highmap.utils.mapHideLoading(),r=common.report.highcharts.object.get(a),r.url=o,r.parameters=e,common.report.highcharts.object.reset(a,r),!0}})}}},mybatis:{Map:function(a,o,e,t,i,r,p){var l=ctx+"/a/report/highmaps/mapData/load",n=common.utils.strToJson(e);Highmap.utils.loadAuthParameters(n,p.authInfo);var m=common.utils.strToJson(t),s={};s.queryName=o,s.param=n,s.mapper=m,s.joinBy=r,Highmap.ajax.init(a,l,s,i,r,p)},reload:function(a,o,e,t,i){var r=common.report.highcharts.object.get(a);if(null!=r){var p=r.url,l=common.utils.strToJson(e);Highmap.utils.loadAuthParameters(l,i.authInfo);var n=common.utils.strToJson(t),m=r.parameters;return common.utils.isEmpty(o)||(m.queryName=o),common.utils.isEmpty(e)||(m.param=l),common.utils.isEmpty(t)||(m.mapper=n),Highmap.ajax.reload(a,p,m,i)}return!1},reloadData:function(a,o,e,t,i,r){var p=common.report.highcharts.object.get(a);if(null!=p){var l=p.url,n=common.utils.strToJson(e);Highmap.utils.loadAuthParameters(n);var m=common.utils.strToJson(t),s=p.parameters;return common.utils.isEmpty(o)||(s.queryName=o),common.utils.isEmpty(e)||(s.param=n),common.utils.isEmpty(t)||(s.mapper=m),Highmap.ajax.reloadData(a,l,s,i,r)}return!1}},utils:{defaultOption:function(a){var o={topNode:"440000000000",title:!0,fontFamily:"Microsoft YaHei",color:{},mapName:"",height:500,width:800,valueType:"map",valueDecimal:0,percentDecimal:2,colorStops:["#EFEFFF",Highcharts.getOptions().colors[0],"#006cee"],setLoading:[],legend:{},navigation:!0,navigationButton:!0,isLayerLoad:!1,valueMapper:[{key:"value",name:"数值",valueSuffix:""}],parentKey:"parentKey",drillKey:"",authInfo:{},mapLoader:{},pointLoader:{},drillUpButton:{},doClick:"",doDrilldown:"",doDrillup:""},e={relativeTo:"spacingBox",y:0,x:0,fill:"white",strokeWidth:2,stroke:"silver",r:3,fontColor:"#000",fontSize:13,selectColor:"#a4edba"},t={backgroundColor:"",borderColor:"",seriesNullColor:"rgba(200, 200, 200, 0.2)",seriesBorderColor:"silver",seriesSelectColor:"#f4e925",dataLabelColor:"",tooltipNameColor:"#F58221",tooltipValueColor:"#0000FF",tooltipMinorValueColor:"",tooltipBackgroundColor:"rgba(255, 255, 255, 0.85)",tooltipBorderColor:""},i={enabled:!0,legendFloat:!1,legendAlign:"right",backgroundColor:"rgba(29,26,40,0.7)",color:Highcharts.theme&&Highcharts.theme.textColor||"black",x:0,y:0},r={isRemote:!1,remoteType:"ajax",isDomain:!0,jsonpCallback:"mapGeoJson",localUrl:"/static/js/maps/json_map/PAC/",remoteUrl:"",commonQueryName:"",commonMapper:""},p={isLoadPoint:!1,isRemote:!1,isDomain:!0,jsonpCallback:"pointGeoJsonp",localUrl:"/static/js/maps/json_mappoint/",points:[],doSetPoint:""},l=common.utils.setDefaultOption(a.drillUpButton,e),n=common.utils.setDefaultOption(a.color,t),m=common.utils.setDefaultOption(a.legend,i),s=common.utils.setDefaultOption(a.mapLoader,r),c=Highmap.utils.loadPointer(a.pointLoader,p),h=common.utils.setDefaultOption(a,o);return h.drillUpButton=l,h.mapLoader=s,h.pointLoader=c,h.color=n,h.legend=this.convLegend(m,h.fontFamily),h.colorStops=this.convColorstops(h.colorStops),h.navigation||(h.navigationButton=!1),h.cursor="",common.utils.isFunction(h.doClick)&&(h.cursor="pointer"),common.utils.isJson(h.valueMapper)?h.valueMapper.hasOwnProperty("valueSuffix")||(h.valueMapper.valueSuffix=""):common.utils.isArray(h.valueMapper)&&$.each(h.valueMapper,function(a,o){o.hasOwnProperty("valueSuffix")||(o.valueSuffix="")}),h},loadPointer:function(a,o){var e=common.utils.setDefaultOption(a,o);if(null!==e.points&&0!==e.points.length){for(var t=new Array,i=0;i<e.points.length;i++){var r={queryName:"",parameters:"",mapper:"",pointName:"标识点",pointVisible:!1,pointColor:"#fffc1b",tooltipTitleColor:"#ff9000",tooltipTextColor:"#f3e924",lineColor:"black",lineWidth:.1,radius:2},p=common.utils.setDefaultOption(e.points[i],r);t.push(p)}e.points=t}return e},convLegend:function(a,o){var e={};if(!a.enabled)return e.enabled=!1,e;switch(e.enabled=!0,e.floating=a.legendFloat,a.legendAlign){case"left":e.align="left",e.layout="vertical",e.verticalAlign="middle";break;case"top":e.layout="horizontal",e.verticalAlign="top";break;case"bottom":e.layout="horizontal",e.verticalAlign="bottom";break;default:e.align="right",e.layout="vertical",e.verticalAlign="middle"}return e.x=a.x,e.y=a.y,e.backgroundColor=a.backgroundColor,e.itemStyle={fontWeight:"bold",fontStyle:o,color:a.color,textDecoration:"none"},e},convColorstops:function(a){var o=[[0,"#EFEFFF"],[.5,Highcharts.getOptions().colors[0]],[1,"#006cee"]];if(!common.utils.isArray(a))return o;var e=new Array,t=a.length;switch(t){case 0:case 1:e=o;break;default:for(var i=1/(t-1),r=0;r<t;r++)e.push([i*r,a[r]])}return e},convValueFormat:function(a){return function(o){if(!a)return"";var e=a.valueMapper,t='<p><b style="font-weight:bold;color:'+a.color.tooltipNameColor+';font-size:13px">'+o.properties.name+"<b/><br>";if(common.utils.isArray(e)){for(var i=0;i<e.length;i++)t+=0===i?'<b style="font-family:'+Highmap.fontFamily+";color:"+a.color.tooltipValueColor+';font-size:12px">'+e[i].name+'：</b><b style="font-family:'+Highmap.fontFamily+";font-weight:bold;color:"+a.color.tooltipValueColor+';">'+o[e[i].key]+" "+e[i].valueSuffix+"</b><br/>":'<b style="font-family:'+Highmap.fontFamily+";color:"+a.color.tooltipMinorValueColor+';font-size:12px">'+e[i].name+'：</b><b style="font-family:'+Highmap.fontFamily+";font-weight:bold;color:"+a.color.tooltipMinorValueColor+';font-size:12px">'+o[e[i].key]+" "+e[i].valueSuffix+"</b><br/>";t+="</p>"}else common.utils.isJson(e)&&(t+='<b style="font-family:'+Highmap.fontFamily+";color:"+a.color.tooltipValueColor+';font-size:12px">'+e.name+'：</b><b style="font-family:'+Highmap.fontFamily+";font-weight:bold;color:"+a.color.tooltipValueColor+';">'+o[e[i].key]+" "+e.valueSuffix+"</b><br/></p>");return t}},getMapLevel:function(a){var o=5;return null!=a&&12===a.length&&("00"===a.substring(2,4)?o=1:"00"===a.substring(4,6)?o=2:"000"===a.substring(6,9)?o=3:"000"===a.substring(9,12)&&(o=4)),o},getGeoJson:function(mapKey,type,mapLoader,callback){function egeojson(){common.utils.showErrorMsg("无法正常加载地图数据，请联系系统管理员处理！",function(){})}var geoJson="";if("key"===type)eval("callback(Highcharts.maps[mapKey])");else{var url="",parmeters={};if(mapLoader.isRemote){if("ajax"===mapLoader.remoteType)url=ctx+mapLoader.remoteUrl,parmeters={map_pac:mapKey,map_level:Highmap.utils.getMapLevel(mapKey)},Highmap.utils.loadAuthParameters(parmeters);else{url=ctx+Highmap.loadMapGeoUrl;var param_={map_pac:mapKey,map_level:Highmap.utils.getMapLevel(mapKey)};Highmap.utils.loadAuthParameters(param_),parmeters={queryName:mapLoader.commonQueryName,param:param_,mapper:mapLoader.commonMapper}}$.ajax({type:"GET",url:url,data:parmeters,async:!1,contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:callback,error:egeojson})}else mapLoader.isDomain?(url=ctx+mapLoader.localUrl+mapKey+".geo.json",$.ajax({type:"GET",url:url,async:!1,contentType:"application/json; charset=utf-8",dataType:"json",success:callback,error:egeojson})):(url=mapLoader.localUrl+mapKey+".geo.json",$.ajax({type:"GET",url:url,async:!1,dataType:"jsonp",jsonpCallback:mapLoader.jsonpCallback,success:callback,error:egeojson}))}},loadAuthParameters:function(a,o){o||(o=Highmap.authInfo);for(var e in o)a.hasOwnProperty(e)||(a[e]=o[e])},mapDrilldown:function(a,o,e){var t=a.properties[Highmap.mapKey],i=a.properties[Highmap.drillKey],r=Highmap.utils.getMapLevel(t),p=a.properties.name;Highmap.utils.mapShowLoading();var l=Highmap.utils.getGeoJson(i,"pac",e.mapLoader,function(n){l=Highcharts.geojson(n);var m=Highmap.ChartDataFormate.FormatGeoData(l,o);"mapbubble"===Highmap.valueType?(Highmap.mapObject.addSeriesAsDrilldown(a,{type:"map",name:p,mapData:l,enableMouseTracking:!1,borderColor:e.color.seriesBorderColor,nullColor:e.color.seriesNullColor,showInLegend:!1,color:Highcharts.getOptions().colors[1],dataLabels:{enabled:!0,format:'<span style="font-family:'+Highmap.fontFamily+';font-weight:bold;font-size: 12px;">{point.properties.name}</span>',color:e.color.dataLabelColor}}),Highmap.mapObject.addSeries({type:Highmap.valueType,mapData:l,name:pointName,joinBy:[joinBy,joinBy],data:m,minSize:4,maxSize:"20%",states:{hover:{color:"#BADA55"}},dataLabels:{enabled:!0,format:"{point.properties.z}"},tooltip:{headerFormat:"",pointFormat:Highmap.pointFormat}})):Highmap.mapObject.addSeriesAsDrilldown(a,{type:"map",data:m,mapData:l,joinBy:Highmap.mapKey,name:p,borderColor:e.color.seriesBorderColor,nullColor:e.color.seriesNullColor,borderRadius:1,borderWidth:1,showInLegend:!1,color:Highcharts.getOptions().colors[1],states:{hover:{color:e.color.seriesSelectColor},select:{color:e.color.seriesSelectColor}},dataLabels:{enabled:!0,format:'<span style="font-family:'+Highmap.fontFamily+';font-weight:bold;font-size: 12px;">{point.properties.name}</span>',color:e.color.dataLabelColor},tooltip:{headerFormat:"",pointFormatter:function(){return Highmap.pointFormat(this)}}});var s=Highmap.utils.loadMappoint(e,i,r);Highmap.level={id:t,name:p,point:s,geojson:l},Highmap.levarray[Highmap.levarray.length-1]=Highmap.level,Highmap.utils.mapHideLoading()})},loadMappoint:function(opt,key,level){var pointObj={},pointids=new Array,pointinfo={},funcName=opt.pointLoader.doSetPoint;common.utils.isFunction(funcName)&&(pointinfo=eval(funcName+"(key,level)"));var ploader=Highmap.utils.loadPointer(pointinfo,opt.pointLoader);if(!ploader.isLoadPoint||0===ploader.points.length)return pointObj.enable=ploader.isLoadPoint,pointObj;var url="",parameters={};if(ploader.isRemote){url=ctx+Highmap.loadPointGeoUrl;for(var queryName="",params=new Array,mapper=new Array,index=0;index<ploader.points.length;index++){var point=ploader.points[index];pointids.push(common.utils.guid()),0===index?queryName=point.queryName:queryName+=","+point.queryName;var param={map_pac:key,map_level:level};Highmap.utils.loadAuthParameters(param);var pp=point.parameters;common.utils.isJson(pp)&&$.each(pp,function(a,o){param.hasOwnProperty(a)||(param[a]=o)}),params.push(param),mapper.push(point.mapper)}parameters={queryNames:queryName,param:params,mappers:mapper,mapperNum:mapper.length}}else url=ctx+ploader.localUrl+key+".geo.json";return $.ajax({type:"GET",url:url,data:parameters,contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:function(a){var o=a;if(null!==o&&0!==o.length)for(var e=0;e<o.length;e++){var t=ploader.points[e],i=pointids[e],r=o[e],p=[];r.features&&r.features.length>0&&(p=Highcharts.geojson(r,"mappoint")),Highmap.mapObject.addSeries({id:i,name:t.pointName,type:"mappoint",data:p,showInLegend:!0,color:t.pointColor,marker:{lineColor:t.lineColor,lineWidth:t.lineWidth,radius:t.radius},dataLabels:{align:"left",verticalAlign:"middle",format:'<span style="font-family:'+Highmap.fontFamily+';font-size: 10px;">{point.properties.name}</span>'},animation:!0,visible:t.pointVisible,tooltip:{headerFormat:'<p><span style="font-family:'+Highmap.fontFamily+";font-size: 12px;color:"+t.tooltipTitleColor+'">{series.name} : </span><br/>',pointFormat:'<span style="font-family:'+Highmap.fontFamily+";font-weight:bold;font-size: 13px;color:"+t.tooltipTextColor+'">{point.name}</span></p>'}})}}}),pointObj.enable=ploader.isLoadPoint,pointObj.ids=pointids,pointObj.num=pointids.length,pointObj},createMapSeries:function(mapName,data,mapData,joinBy,opt,callback){function doCreate(mapJson){geoJson=Highcharts.geojson(mapJson),Highmap.topMapJson=geoJson;var data_=Highmap.ChartDataFormate.FormatGeoData(geoJson,data);series="mapbubble"===Highmap.valueType?[{type:"map",name:mapName,mapData:geoJson,enableMouseTracking:!1,borderColor:opt.color.seriesBorderColor,nullColor:opt.color.seriesNullColor,showInLegend:!1,color:Highcharts.getOptions().colors[1],dataLabels:{enabled:!0,format:'<span style="font-family:'+Highmap.fontFamily+";font-weight:bold;font-size: 12px;color:"+opt.pointLoader.tooltipTextColor+'">{point.properties.name}</span>',color:opt.color.dataLabelColor},states:{hover:{color:opt.color.seriesSelectColor},select:{color:opt.color.seriesSelectColor}}}]:[{type:"map",data:data_,mapData:geoJson,joinBy:joinBy,name:mapName,borderColor:opt.color.seriesBorderColor,nullColor:opt.color.seriesNullColor,borderRadius:1,borderWidth:1,showInLegend:!1,color:Highcharts.getOptions().colors[1],states:{hover:{color:opt.color.seriesSelectColor},select:{color:opt.color.seriesSelectColor}},dataLabels:{enabled:!0,format:'<span style="font-family:'+Highmap.fontFamily+';font-weight:bold;font-size: 12px;">{point.properties.name}</span>',color:opt.color.dataLabelColor},tooltip:{headerFormat:"",pointFormatter:function(){return Highmap.pointFormat(this)}}}],eval("callback(series)")}var series={},mapKey=mapData,type="key";"PAC:"===mapData.substring(0,4)&&(mapKey=mapData.substring(4,mapData.length),type="pac",Highmap.topMapNode=mapKey);var geoJson=Highmap.utils.getGeoJson(mapKey,type,opt.mapLoader,doCreate)},mapShowLoading:function(){null!==Highmap.setLoading&&Highmap.setLoading.length>1&&common.utils.isFunction(Highmap.setLoading[0])&&common.utils.isFunction(Highmap.setLoading[1])?eval(Highmap.setLoading[0]+"()"):common.utils.showLoading()},mapHideLoading:function(){null!==Highmap.setLoading&&Highmap.setLoading.length>1&&common.utils.isFunction(Highmap.setLoading[0])&&common.utils.isFunction(Highmap.setLoading[1])?eval(Highmap.setLoading[1]+"()"):common.utils.closeLoading()}}};