!function(e,s){function t(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var i=!0;e.extend(t.prototype,{_isOpenSelectbox:function(e){return!!e&&this._getInst(e).isOpen},_isDisabledSelectbox:function(e){return!!e&&this._getInst(e).isDisabled},_attachSelectbox:function(s,t){function n(){var s,t,i=this.attr("id").split("_")[1];for(s in u._state)s!==i&&u._state.hasOwnProperty(s)&&(t=e("select[sb='"+s+"']")[0])&&u._closeSelectbox(t)}function a(){var t=!(!arguments[1]||!arguments[1].sub),n=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(a){var l,r=e(this),g=e("<li>");r.is(":selected")&&(o.text(r.text()),b=i),a===f-1&&g.addClass("last"),r.is(":disabled")||n?(l=e("<span>",{text:r.text()}).addClass(p.settings.classDisabled),t&&l.addClass(p.settings.classSub),l.appendTo(g)):(l=e("<a>",{href:"#"+r.val(),rel:r.val()}).text(r.text()).bind("click.sb",function(t){t&&t.preventDefault&&t.preventDefault();var i=c,n=e(this);i.attr("id").split("_")[1];u._changeSelectbox(s,n.attr("rel"),n.text()),u._closeSelectbox(s)}).bind("mouseover.sb",function(){var s=e(this);s.parent().siblings().find("a").removeClass(p.settings.classFocus),s.addClass(p.settings.classFocus)}).bind("mouseout.sb",function(){e(this).removeClass(p.settings.classFocus)}),t&&l.addClass(p.settings.classSub),r.is(":selected")&&l.addClass(p.settings.classFocus),l.appendTo(g)),g.appendTo(d)})}if(this._getInst(s))return!1;var l,o,c,d,r=e(s),u=this,p=u._newInst(r),b=!1,g=(r.find("optgroup"),r.find("option")),f=g.length;r.attr("sb",p.uid),e.extend(p.settings,u._defaults,t),u._state[p.uid]=!1,r.hide(),l=e("<div>",{id:"sbHolder_"+p.uid,class:p.settings.classHolder,tabindex:r.attr("tabindex")}),o=e("<a>",{id:"sbSelector_"+p.uid,href:"#",class:p.settings.classSelector,click:function(t){t.preventDefault(),n.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];u._state[i]?u._closeSelectbox(s):u._openSelectbox(s)}}),(c=e("<a>",{id:"sbToggle_"+p.uid,href:"#",class:p.settings.classToggle,click:function(t){t.preventDefault(),n.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];u._state[i]?u._closeSelectbox(s):u._openSelectbox(s)}})).appendTo(l),d=e("<ul>",{id:"sbOptions_"+p.uid,class:p.settings.classOptions,css:{display:"none"}}),r.children().each(function(s){var t,i=e(this),n={};i.is("option")?a(i):i.is("optgroup")&&(t=e("<li>"),e("<span>",{text:i.attr("label")}).addClass(p.settings.classGroup).appendTo(t),t.appendTo(d),i.is(":disabled")&&(n.disabled=!0),n.sub=!0,a(i.find("option"),n))}),b||o.text(g.first().text()),e.data(s,"selectbox",p),l.data("uid",p.uid).bind("keydown.sb",function(s){var t=s.charCode?s.charCode:s.keyCode?s.keyCode:0,i=e(this),n=i.data("uid"),a=i.siblings("select[sb='"+n+"']").data("selectbox"),l=i.siblings(["select[sb='",n,"']"].join("")).get(0),o=i.find("ul").find("a."+a.settings.classFocus);switch(t){case 37:case 38:if(o.length>0){e("a",i).removeClass(a.settings.classFocus),(c=o.parent().prevAll("li:has(a)").eq(0).find("a")).length>0&&(c.addClass(a.settings.classFocus).focus(),e("#sbSelector_"+n).text(c.text()))}break;case 39:case 40:var c;e("a",i).removeClass(a.settings.classFocus),(c=o.length>0?o.parent().nextAll("li:has(a)").eq(0).find("a"):i.find("ul").find("a").eq(0)).length>0&&(c.addClass(a.settings.classFocus).focus(),e("#sbSelector_"+n).text(c.text()));break;case 13:o.length>0&&u._changeSelectbox(l,o.attr("rel"),o.text()),u._closeSelectbox(l);break;case 9:l&&(a=u._getInst(l))&&(o.length>0&&u._changeSelectbox(l,o.attr("rel"),o.text()),u._closeSelectbox(l));var d=parseInt(i.attr("tabindex"),10);s.shiftKey?d--:d++,e("*[tabindex='"+d+"']").focus();break;case 27:u._closeSelectbox(l)}return s.stopPropagation(),!1}).delegate("a","mouseover",function(s){e(this).addClass(p.settings.classFocus)}).delegate("a","mouseout",function(s){e(this).removeClass(p.settings.classFocus)}),o.appendTo(l),d.appendTo(l),l.insertAfter(r),e("html").on("mousedown",function(s){s.stopPropagation(),e("select").selectbox("close")}),e([".",p.settings.classHolder,", .",p.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(s){var t=this._getInst(s);if(!t)return!1;e("#sbHolder_"+t.uid).remove(),e.data(s,"selectbox",null),e(s).show()},_changeSelectbox:function(s,t,n){var a,l=this._getInst(s);l&&(a=this._get(l,"onChange"),e("#sbSelector_"+l.uid).text(n)),t=t.replace(/\'/g,"\\'"),e(s).find("option[value='"+t+"']").prop("selected",i),l&&a?a.apply(l.input?l.input[0]:null,[t,l]):l&&l.input&&l.input.trigger("change")},_enableSelectbox:function(s){var t=this._getInst(s);if(!t||!t.isDisabled)return!1;e("#sbHolder_"+t.uid).removeClass(t.settings.classHolderDisabled),t.isDisabled=!1,e.data(s,"selectbox",t)},_optionSelectbox:function(s,t,i){var n=this._getInst(s);if(!n)return!1;n[t]=i,e.data(s,"selectbox",n)},_openSelectbox:function(s){var t=this._getInst(s);if(t&&!t.isOpen&&!t.isDisabled){var n=e("#sbOptions_"+t.uid),a=parseInt(e(window).height(),10),l=e("#sbHolder_"+t.uid).offset(),o=e(window).scrollTop(),c=n.prev().height(),d=a-(l.top-o)-c/2,r=this._get(t,"onOpen");n.css({top:c+"px",maxHeight:d-c+"px"}),"fade"===t.settings.effect?n.fadeIn(t.settings.speed):n.slideDown(t.settings.speed),e("#sbToggle_"+t.uid).addClass(t.settings.classToggleOpen),this._state[t.uid]=i,t.isOpen=i,r&&r.apply(t.input?t.input[0]:null,[t]),e.data(s,"selectbox",t)}},_closeSelectbox:function(s){var t=this._getInst(s);if(t&&t.isOpen){var i=this._get(t,"onClose");"fade"===t.settings.effect?e("#sbOptions_"+t.uid).fadeOut(t.settings.speed):e("#sbOptions_"+t.uid).slideUp(t.settings.speed),e("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),this._state[t.uid]=!1,t.isOpen=!1,i&&i.apply(t.input?t.input[0]:null,[t]),e.data(s,"selectbox",t)}},_newInst:function(e){return{id:e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:e,uid:Math.floor(99999999*Math.random()),isOpen:!1,isDisabled:!1,settings:{}}},_getInst:function(s){try{return e.data(s,"selectbox")}catch(e){throw"Missing instance data for this selectbox"}},_get:function(e,s){return void 0!==e.settings[s]?e.settings[s]:this._defaults[s]}}),e.fn.selectbox=function(s){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):this.each(function(){"string"==typeof s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this].concat(t)):e.selectbox._attachSelectbox(this,s)})},e.selectbox=new t,e.selectbox.version="0.2"}(jQuery);