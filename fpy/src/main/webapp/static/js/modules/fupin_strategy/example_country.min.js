var DATA_MAP_DATA_TYPE={AMOUNT_POOR_FAMILY:1,AMOUNT_POOR_PEOPLE:2,AMOUNT_SUCCESS_FAMILY:3,AMOUNT_SUCCESS_PEOPLE:4,RATE_PEOPLE:5,RATE_SUCCESS:6},DEFAULT_DATA_MAP_DATA_TYPE=DATA_MAP_DATA_TYPE.AMOUNT_SUCCESS_FAMILY;$(function(){function init(){$btnCountryFile.on(CLICK_EV,function(){poorFile.showCountryFile(curAreaID)}),$scopeList.on("click","li",function(e){var a=$(this).attr("data-index"),t=$(this).text();$btnMapIndex.find("strong").text(t),$btnMapIndex.find(".icon").removeClass("on"),loadMap(parseInt(a))}),$btnMapIndex.on(CLICK_EV,function(e){e.stopPropagation(),$(this).find(".icon").toggleClass("on"),toggleScopeList()}),$scopeList.on(CLICK_EV,function(e){e.stopPropagation()}).on(CLICK_EV,"li",function(){var e=$(this),a=e.attr("data-scope");e.hasClass(CLASS_ACTIVE)||(e.addClass(CLASS_ACTIVE).siblings().removeClass(CLASS_ACTIVE),changeMapDataScope(currentScope=a),hideScopeList())}),$body.on(CLICK_EV,hideScopeList),$blockPoorAnalysisWrap.on(CLICK_EV,".link-more",function(){$.dataMonitor.showDataMonitor({target:DATA_MONITOR_TARGET_POOR_ANALYSIS})}),$blockBars.on(CLICK_EV,".vl-item",function(){var e;switch($(this).attr("data-name")){case"道路硬化":e=DATA_MONITOR_TARGET_ROAD;break;case"安全饮水":e=DATA_MONITOR_TARGET_WATER;break;case"生活用电":e=DATA_MONITOR_TARGET_ELECTRICITY;break;case"医疗设施":e=DATA_MONITOR_TARGET_MEDICAL_FACILITY;break;case"广播电视":e=DATA_MONITOR_TARGET_BROADCAST;break;case"网络覆盖":e=DATA_MONITOR_TARGET_NET}e&&$.dataMonitor.showDataMonitor({target:e})}),$blockAlarm.on(CLICK_EV,"td b",function(){var e;switch($(this).attr("data-target")){case"alarmed_family":e=DATA_MONITOR_TARGET_ALARMED_POOR;break;case"alarmed_records":e=DATA_MONITOR_TARGET_ALARMED_RECORDS;break;case"alarmed_country":e=DATA_MONITOR_TARGET_ALARMED_MONEY;break;case"alarmed_family_not_visited":e=DATA_MONITOR_TARGET_ALARMED_VISIT}e&&$.dataMonitor.showDataMonitor({target:e})}),$blockMapDataTypes.on(CHANGE_EV,'[name="map_data_type"]',function(){changeMapDataType($(this).val())})}function toggleScopeList(){$scopeList.hasClass(CLASS_SHOW)?hideScopeList():showScopeList()}function showScopeList(){$scopeList.addClass(CLASS_SHOW)}function hideScopeList(){$scopeList.removeClass(CLASS_SHOW)}function createChartElem(){return $('<div class="chart"></div>')}function renderPage(){function e(){0==t&&n&&hideLoadingMask()}function a(){hideLoadingMask()}var t=1,n=!1;return renderStatic(function(){t--,e()},a),{onSuccess:function(){n=!0,e()},onError:a}}function onRenderPageErr(){renderPage()}function changeMapDataType(e){"undefined"!=typeof changeDataMapDataType&&changeDataMapDataType(e)}function changeMapDataScope(e){"undefined"!=typeof changeDataMapDataScope&&changeDataMapDataScope(e)}function changeDataArea(e,a,t){e&&(curLevel=e,$.dataMonitor.treeCurLevel=curLevel),a&&(curAreaID=a,$.dataMonitor.treeCurAreaID=curAreaID);(t=extend({hasCountryFile:!1},t)).hasCountryFile;return curLevel==LEVELS.COUNTRY?($.poorFile.showCountryPhoto(a),$blockBottom.hide()):($("#exampleCountryPhoto").length>0&&$("#exampleCountryPhoto").hide(),$blockBottom.show()),renderPage()}function updateAreaUI(e){var a=e.area_name;currentAreaDesc=e.area_desc,$scopeAreaName.text(a),currentScope==DEFAULT_AREA_SCOPE&&$btnArea.text(a),currentAreaDesc?($btnAreaDesc.show(),$poorFamilyListWrap.removeClass("down")):($btnAreaDesc.hide(),$poorFamilyListWrap.addClass("down"))}function renderStatic(successCB,errorCB){function renderIndexChart(d,chartId){var jsonData=d;if("highchart"==d.chart_type){var container=document.getElementById(chartId),func=d.convert_method;eval(func+"(container,jsonData.data,jsonData.config)")}else if("D3"==d.chart_type){var func=d.convert_method;eval(func+"(chartId,jsonData.data,jsonData.config)")}else echarts.init(document.getElementById(chartId)).setOption(commonEchartConfig[jsonData.convert_method](jsonData.config))}function bindBarHover(){$(".percent-bar").find("p").hover(function(){$(this).find(".tips").show()},function(){$(this).parents(".percent-bar").find(".tips").hide()})}function renderAverage(e){$("#blockAverage").html(template("tplAverage",e))}function renderGuarantee(e){$("#blockGuarantee").html(template("tplGuarantee",e)),renderIndexChart(e.compile_renovate_plan.chart_config_renovate_plan,"compileRenovatePlanChart"),renderIndexChart(e.renovate_three.chart_config_renovate_three,"renovateThreeChart")}function renderBars(e){e&&($blockBars.html(template("tplBars",e)),renderIndexChart(e.chart_config_road,"facilityShortChart1"),renderIndexChart(e.chart_config_rubbish,"facilityShortChart2"),renderIndexChart(e.chart_config_sewage,"facilityShortChart3"),renderIndexChart(e.chart_config_water_supply,"facilityShortChart4"))}function renderPoorAnalysis(e){$("#blockPoorAnalysis").html(template("tplPoorAnalysis",e))}function renderCapital(e){$("#blockCapital").html(template("tplCapital",e)),renderIndexChart(e.compile_promote_plan.chart_config_compile_promote_plan,"compilePromotePlanChart"),renderIndexChart(e.green_beautiful.chart_config_green_beautiful,"greenBeautifulChart")}function renderGauge(e,a,t){var n=t(a),o=n.data,r=n.config;loadLiquidFillGauge(e,o,r)}function renderTopIndex(e){var a=$("#blockTop");a.html(template("tplTopIndex",e)),renderIndexChart(e.reach_standard_country.chart_config_reach_standard,"topChartLeft"),renderIndexChart(e.finish_promote_country.chart_config_reach_standard,"topChartRight"),a.children("ul").on(CLICK_EV,".data1 strong",function(){$.dataMonitor.showDataMonitor({target:DATA_MONITOR_EXAMPLE_COUNTRY_BUILDING})}).on(CLICK_EV,".data2 strong",function(){console.log("提升创建")})}function renderBottomIndex(e){function a(){renderBottomIndex.lastStat=e}renderBottomIndex.lastStat||a(),function(e){$("#blockBottom").html(template("tplBottomIndex",{lastStat:renderBottomIndex.lastStat,stat:e})),$("#blockBottom").find(".num.dynamic").each(count),a()}(e)}function count(e){var a=$(this);e=$.extend({},e||{},a.data("countToOptions")||{}),a.countTo(e)}ajax({url:URLS.URL_DATA_EXAMPLE_COUNTRY_INDEX_STATIC_DATA,data:{level:curLevel,id:curAreaID,scope:currentScope},success:function(e){var a=e.code,t=e.data;0==a&&t?(updateAreaUI(t),renderTopIndex(extend({},{reach_standard_country:t.reach_standard_country,finish_promote_country:t.finish_promote_country},{area_level:t.area_level,LEVELS:LEVELS})),renderAverage(t.more20_reach_standard),renderGuarantee(extend({},{compile_renovate_plan:t.compile_renovate_plan,renovate_three:t.renovate_three})),renderBars(t.base_facility_short),renderPoorAnalysis(t.more20_promote_creation),renderCapital(extend({},{compile_promote_plan:t.compile_promote_plan,green_beautiful:t.green_beautiful})),bindBarHover(),successCB&&successCB()):errorCB&&errorCB()},error:function(){errorCB&&errorCB()}})}function d3OptsAverage1(e){var a={},t=e.percent,n=liquidFillGaugeDefaultSettings();return n.circleThickness=.1,n.circleFillGap=.1,"100"==t?(n.circleColor="#f3e824",n.textColor="#f3e824",n.waveTextColor="#f3e824",n.waveColor="#322e41"):(n.circleColor="#6cc3ff",n.textColor="#fff",n.waveTextColor="#fff",n.waveColor="#6cc3ff"),n.textVertPosition=.5,n.waveAnimateTime=1e3,n.waveHeight=.05,n.waveAnimate=!0,n.waveRise=!1,n.waveHeightScaling=!1,n.waveOffset=.25,n.textSize=.75,n.waveCount=3,n.displayPercent=!1,n.maxValue=7365,a.config=n,a.data=t,a}function d3OptsAverage2(e){var a={},t=e.percent,n=liquidFillGaugeDefaultSettings();return n.circleThickness=.1,n.circleFillGap=.1,"100"==t?(n.circleColor="#f3e824",n.textColor="#f3e824",n.waveTextColor="#f3e824",n.waveColor="#322e41"):(n.circleColor="#6cc3ff",n.textColor="#fff",n.waveTextColor="#fff",n.waveColor="#6cc3ff"),n.textVertPosition=.5,n.waveAnimateTime=1e3,n.waveHeight=.05,n.waveAnimate=!0,n.waveRise=!1,n.waveHeightScaling=!1,n.waveOffset=.25,n.textSize=.75,n.waveCount=3,a.config=n,a.data=t,a}var monitorHelper=$.monitorHelper,CONST_RADIO_VALUES=$.components.CONST_RADIO_VALUES,CONST_CHECK_VALUES=$.components.CONST_CHECK_VALUES,ROW_KEY=$.components.ROW_KEY,POOR_ATTRIBUTE_VALUES=CONST_RADIO_VALUES.POOR_ATTRIBUTE,EDU_LEVELS_VALUES=CONST_RADIO_VALUES.EDU_LEVELS,LABOR_ATTRIBUTE_VALUES=CONST_RADIO_VALUES.LABOR_ATTRIBUTE,EXCEPTION_TYPE_VALUES=CONST_CHECK_VALUES.EXCEPTION_TYPE,DATA_MONITOR_SECOND_POPUP=monitorHelper.DATA_MONITOR_SECOND_POPUP,DATA_MONITOR_EXAMPLE_COUNTRY_BUILDING={TITLE:"示范村建设",TYPE:"example_country_building",TAB:[{NAME:"整治达标",VALUE:"renovate_standard"}]},CLASS_LEVEL_COUNTRY="level-country",CLASS_SHOW="show",CLASS_ACTIVE="active",CLASS_HIDDEN="hidden",CLICK_EV="click",CHANGE_EV="change",win=window,extend=$.extend,param=$.param,ajax=Helpers.ajax,renderDataMonitorTree=monitorHelper.renderDataMonitorTree,$body=$("body"),$btnArea=$("#btnArea"),$btnMapIndex=$("#btnMapIndex"),$scopeList=$("#scopeList"),$btnAreaDesc=$("#btnAreaDesc"),$btnPoorFamilyList=$("#btnPoorFamilyList"),$poorFamilyListWrap=$("#poorFamilyListWrap"),$scopeAreaName=$("#scopeAreaName"),$scopeList=$("#scopeList"),$btnCountryFile=$("#btnCountryFile"),$blockMapDataTypes=$("#blockMapDataTypes"),$blockBottom=$("#blockBottom"),$blockBars=$("#blockBars"),$blockAlarm=$("#blockAlarm"),$blockPoorAnalysisWrap=$("#blockPoorAnalysisWrap"),poorFile=$.poorFile,dynamicTimer=null,countDownTimer=null,curLevel=DEFAULT_LEVEL,curAreaID=DEFAULT_AREA_ID,currentScope=DEFAULT_AREA_SCOPE,currentAreaDesc=null;init(),win.changeDataDistrict=changeDataArea,$.dataMonitor={currentTarget:null,$analyseContent:null,curAreaName:"",treeCurLevel:curLevel,treeCurAreaID:curAreaID,firstTabState:null,init:function(){this.loadMonitorTpl(),$body.on(CLICK_EV,function(){var e=$(".select-box");e.removeClass("selected").find(".select-list").hide(),e.find(".arrow").removeClass("arrow-on")})},loadMonitorTpl:function(){var e=this;$.ajax({url:URLS.URL_TPL_DATA_MONITOR+"?_="+(new Date).getTime(),async:!1,success:function(a){$("body").append(a),e.$monitorContent=$("#monitorContent")}})},bindHeader:function(){var e=this;$("#popupPoorMonitor").off(CLICK_EV).on(CLICK_EV,".js-monitor-close",e.popup.close),$("#monitorHeader .monitor-nav").on("click","li",function(a){var t=$(this),n={};n.configOrder=t.data("config-order"),t.siblings().removeClass("active"),t.addClass("active"),e.renderTree(n)}),$("#monitorHeader .tab-year").on("click","i",function(a){var t={};if($(this).hasClass("js-forbid"))return 0;t.configOrder=$(".monitor-nav li.active").data("config-order"),e.renderTree(t)});var a=$("#monitorHeader");a.find(".js-select-box").on("click",function(){var e=$(this),t=e.find(".select-list"),n=e.parents(".select-area").find(".js-select-box").not(this);return e.hasClass("forbid")?0:(e.toggleClass("selected"),t.toggle(),e.find(".arrow").toggleClass("arrow-on"),n.removeClass("selected").find(".select-list").hide(),n.find(".arrow").removeClass("arrow-on"),function(){var e=t.innerWidth(),a=t.innerHeight();e=e>150?150:e,t.find(".jspPane").length<1&&t.width(e),a>320&&t.jScrollPane(commonJSPConfig)}(),a.find(".download-select li").on("click",function(){var e=$(this).attr("data-export-url");$.components.tableEvent.exportTable(e)}),!1)})},setSecondHeader:function(e,a){var t=$("#monitorHeader #secondTabTitle"),n=$("#monitorHeader .js-monitor-close");t.text(a).removeClass("hide"),t.attr("data-tabtype",e.tabtype),n.addClass("second-tab-close")},onSecondTab:function(){return!$("#monitorHeader #secondTabTitle").hasClass("hide")},pushFirstTabState:function(e){var a=this;a.firstTabState=extend({area_level:a.treeCurLevel,area_id:a.treeCurAreaID},e)},popFirstTabState:function(){var e=this,a=e.firstTabState;return e.firstTabState=null,a},renderSecondTabContent:function(e){},popup:{open:function(){$("#popupPoorMonitor").show()},close:function(){var e=$(this),a=$.dataMonitor,t=$("#monitorHeader #secondTabTitle");$("#monitorHeader .js-monitor-close");if(e.hasClass("second-tab-close")){t.addClass("hide"),e.removeClass("second-tab-close");var n=a.popFirstTabState();n&&a.renderTree(extend(n,{year:a.getCurYear()}))}else a.treeCurLevel=curLevel,a.treeCurAreaID=curAreaID,$("#popupPoorMonitor").hide()}},secondPopup:{openDetail:function(e){var a=$.dataMonitor,t=this,n=$("#popupPoorMonitorSecondWrap");n.html(template("tplSecondPopup")),t.areaSelect.render(e,function(){n.show(),t.bindSelectArea(),a.renderContent(extend({},e,{target:DATA_MONITOR_SECOND_POPUP.DETAIL_LIST})),t.bindClosePopup()})},openAreaData:function(e){var a=$.dataMonitor,t=$("#popupPoorMonitorSecondWrap");t.html(template("tplSecondPopup")),t.show(),a.renderContent(extend({},e,{target:DATA_MONITOR_SECOND_POPUP.AREA_DATA})),this.bindClosePopup()},close:function(){$("#popupPoorMonitorSecondWrap").hide()},bindClosePopup:function(){$("#popupPoorMonitorSecond").on(CLICK_EV,".js-second-popup-close",this.close)},bindSelectArea:function(){var e=$("#popupPoorMonitorSecond");e.off("click",".js-select-box",this.areaSelect.toggle).off("click",".js-select-list li",this.areaSelect.choose),e.on("click",".js-select-box",this.areaSelect.toggle).on("click",".js-select-list li",this.areaSelect.choose)},areaSelect:{toggle:function(){var e=$(this),a=e.find(".select-list"),t=e.parents(".select-area").find(".js-select-box").not(this);return e.hasClass("forbid")?0:(e.toggleClass("selected"),a.toggle(),e.find(".arrow").toggleClass("arrow-on"),t.removeClass("selected").find(".select-list").hide(),t.find(".arrow").removeClass("arrow-on"),function(){var e=a.innerWidth(),t=a.innerHeight();e=e>150?150:e,a.find(".jspPane").length<1&&a.width(e),t>320&&a.jScrollPane(commonJSPConfig)}(),!1)},choose:function(){function e(){var e={url:URLS.URL_DATA_MONITOR_DETAIL_TABLE,params_url:URLS.URL_DATA_MONITOR_DETAIL_PARAMS_INFO,secondPopup:!0,secondPopupType:"detail_list",area_level:r,area_id:o,year:i,month:l||"",wintype:t.getWinType(),tabtype:t.getCurTabType()};t.buildConfigCheckArea(e)}var a=$(this),t=$.dataMonitor,n=$("#popupPoorMonitorSecond #basicInfo .select-area");if(a.parents("#areaBarrio").length>0){var o=a.attr("data-id"),r=a.closest(".js-select-box").attr("level"),i=n.find("#selectYear .select-box>span").attr("data-value");if(n.find("#selectMonth").length>0)l=n.find("#selectMonth .select-box>span").attr("data-value");e()}if(a.parents("#selectYear").length>0){i=a.attr("data-year");if(n.find("#selectMonth").length>0)l=n.find("#selectMonth .select-box>span").attr("data-value");r=n.find("#areaBarrio .js-select-box").last().attr("level");""==(o=n.find("#areaBarrio .js-select-box").last().attr("selected_id"))&&(o=n.find("#areaBarrio .js-select-box").eq(-2).attr("selected_id"),r=n.find("#areaBarrio .js-select-box").eq(-2).attr("level")),e()}if(a.parents("#selectMonth").length>0){var l=a.attr("data-month"),i=n.find("#selectYear .select-box>span").attr("data-value"),r=n.find("#areaBarrio .js-select-box").last().attr("level");""==(o=n.find("#areaBarrio .js-select-box").last().attr("selected_id"))&&(o=n.find("#areaBarrio .js-select-box").eq(-2).attr("selected_id"),r=n.find("#areaBarrio .js-select-box").eq(-2).attr("level")),e()}showLoadingMask(),ajax({url:URLS.URL_DATA_MONITOR_DETAIL_BASIC_INFO,data:{level:r,id:o,year:i,month:l||"",wintype:t.getWinType(),tabtype:t.getCurTabType()},success:function(e){var a=e.code,t=e.data;0==a&&t?(t.hasSelectArea=!0,$("#popupPoorMonitorSecond").find(".basic-info-wrap").html(template("tplSecondPopupBasicInfo",t))):hideLoadingMask()},error:function(){hideLoadingMask()}})},render:function(e,a){var t=$.dataMonitor,n={},o={level:e.area_level,id:e.area_id,year:e.year,month:e.month,wintype:t.getWinType(),tabtype:t.getCurTabType(),page:e.table_page||1};showLoadingMask(),ajax({url:URLS.URL_DATA_MONITOR_DETAIL_BASIC_INFO,data:extend(o,n),success:function(e){var t=e.code,n=e.data;n.AREA_SCOPE=AREA_SCOPE,0==t&&n?(n.hasSelectArea=!0,$("#secondPopupTitle").text(n.win_title),$("#popupPoorMonitorSecond").find(".basic-info-wrap").html(template("tplSecondPopupBasicInfo",n)),$.isFunction(a)&&a()):hideLoadingMask()},error:function(){hideLoadingMask()}})}}},bindSecondTab:function(e,a){var t=this,n=t.getWinType(),o=$("#"+e.tabName+"CheckArea"),r=a,i=r.VALUE;e=extend({},e,{checkActiveObj:t.getCheckAreaActiveObj(o)});var l=extend({},e,{target:n+"_"+i,tabtype:i});t.pushFirstTabState(e),t.setSecondHeader(l,r.TITLE),t.renderTree(l)},exportWrap:{open:function(){$("#exportWrap").show()},close:function(){$("#exportWrap").hide()}},getWinType:function(){return $("#monitorHeader .header-title").data("win-type")},getCurYear:function(){return $("#monitorHeader .tab-year .active").data("value")},getCurTabType:function(){return this.onSecondTab()?$("#monitorHeader #secondTabTitle").attr("data-tabtype"):$("#monitorHeader .monitor-nav .active").data("tab-type")},getCheckAreaActiveObj:function(e){var a={};return e.find(".radio-row").each(function(e,t){var n=$(this),o=n.data("key"),r=n.find(".radio.active").data("value");a[o]=r}),e.find(".check-row").each(function(e,t){var n=$(this),o=[],r=n.data("key");n.find(".check.active").each(function(e,a){var t=$(this).data("value");t&&o.push(t)}),a[r]=o.join(",")}),a},buildCheckAreaHtml:function(e,a){for(var t=$.components.buildCheckRow,n='<table class="check-area-table">',o=0;o<e.length;o++){var r=0;if("object"==typeof e[o]){for(var i in a)if(i==e[o].rowKey){n+=t(e[o],a[i]),r=1;break}}else for(var i in a)if(i==e[o]){n+=t(e[o],a[i]),r=1;break}0==r&&(n+=t(e[o]))}return n+"</table>"},bindCheckArea:function(e,a){var t,n=this;e=extend({},e),(t=e.secondPopup?$("#"+e.paramsTplId):$("#"+e.tabName+"CheckArea")).off("click").on("click",".radio-row .radio",function(o){var r=$(this);if(e=extend({},e),r.hasClass("disabled"))return 0;if(r.siblings().removeClass("active"),r.addClass("active"),!r.data("has-own-handler"))if(r[0].hasAttribute("data-url"))e.url=URLS[r.attr("data-url")],e.tplID="tpl"+e.TabName+"ChartTable",e.secondPopup?n.renderSecondPopupTable(e,a):n.renderChartTable(e,a);else{var i,l;t.find(".radio-row .radio.active").each(function(e,a){$(this)[0].hasAttribute("data-url")&&(i=$(this).attr("data-url"),l=$(this).attr("data-tpl-id"))}),e.url=URLS[i]||e.url,e.tplID=l||e.tplID,e.secondPopup?n.renderSecondPopupTable(e,a):n.renderChartTable(e,a)}}),t.on("click",".check-row .check",function(t){var o=$(this);if(e=extend({},e),o.hasClass("disabled"))return 0;o.toggleClass("active"),e.secondPopup?n.renderSecondPopupTable(e,a):n.renderChartTable(e,a)})},buildCheckArea:function(e,a,t,n){var o=this,r=$("#"+e.tabName+"CheckArea"),i=o.buildCheckAreaHtml(a,e.checkActiveObj||t);r.html(i),o.renderContentBasicInfo(e),o.bindCheckArea(e,n)},buildConfigCheckArea:function(e){var a=this;e.secondPopup&&(e.paramsTplId="paramsCheckArea"),a.renderConfigCheckArea(e),e.secondPopup||a.renderContentBasicInfo(e),a.bindCheckArea(e)},renderWin:function(e){var a=this;showLoadingMask(),ajax({url:URLS.URL_DATA_MONITOR_BASIC_INFO,data:{level:curLevel,id:curAreaID},success:function(t){var n=t.code,o=t.data;if(o=extend({},o,e.target),0==n&&o){$("#monitorHeader").html(template("tplMonitorHeader",o));var r=$("#monitorHeader .tab-switch");$.components.tabSwitch(r,o.years.available_years,o.years.selected_value),a.bindHeader(),a.renderTree()}else hideLoadingMask()},error:function(){hideLoadingMask()}})},renderTree:function(e){var a=this;e=extend({year:a.getCurYear(),area_level:a.treeCurLevel,area_id:a.treeCurAreaID,wintype:a.getWinType(),tabtype:a.getCurTabType()},e),renderDataMonitorTree($("#monitorTree"),extend({instance:a},e))},showDataMonitor:function(e){var a=this;a.renderWin(e),a.popup.open()},renderContent:function(e){$.dataMonitor,$("#monitorHeader #secondTabTitle");for(var a=e.target.split("_"),t=[],n="",o=0,r=a.length;o<r;o++)t.push(a[o].substring(0,1).toUpperCase()+a[o].substring(1));e.TabName=t.join(""),e.tabName=a[0]+t.join("").substring(a[0].length),n="render"+t.join(""),$.dataMonitor[n](e)},renderContentBasicInfo:function(e){var a=this,t=(e.TabName,a.getCurTabType()),n=$("#"+e.tabName+"CheckArea");showLoadingMask(),ajax({url:URLS.URL_DATA_MONITOR_CONTENT_BASIC_INFO,data:{level:e.area_level,id:e.area_id,year:e.year},success:function(e){if(t==a.getCurTabType()){var o=e.code,r=e.data;0==o&&r?n.find("[data-key='scope'] .radio").each(function(e,a){var t=$(this),n=e+1;r.scope_available[n]||t.addClass("disabled")}):hideLoadingMask()}},error:function(){hideLoadingMask()}})},renderConfigCheckArea:function(e){var a,t=this,n=(e.TabName,t.getWinType()),o=t.getCurTabType();a=e.paramsTplId?$("#"+e.paramsTplId):$("#"+e.tabName+"CheckArea"),showLoadingMask(),ajax({url:e.params_url,data:{level:e.area_level,id:e.area_id,year:e.year,wintype:n,tabtype:o},success:function(r){if(n==t.getWinType()&&o==t.getCurTabType()){var i=r.code,l=r.data;0==i&&l?(a.html(template("tplConfigCheckArea",l)),e.secondPopup?t.renderSecondPopupTable(e):t.renderChartTable(e)):hideLoadingMask()}},error:function(){hideLoadingMask()}})},renderChartTable:function(e,a){function t(){return e.wintype||l.getWinType()}function n(){return e.tabtype||l.getCurTabType()}function o(a){var t=[];for(var n in a)"chart_config"==n.substring(0,12)&&t.push({name:n,data:a[n]});for(var o=0;o<t.length;o++){var r=a[t[o].name],i=t[o].name.substring(13);if(e.chartHeaderId)l=e.chartHeaderId+$.components.underlineToCamel(i);else var l=e.tabName+"Chart"+$.components.underlineToCamel(i);echarts.init(document.getElementById(l)).setOption(commonEchartConfig[r.convert_method](r.config))}}var r,i,l=this,c=(e.TabName,e.tplID||"tpl"+e.TabName+"ChartTable"),s=t(),d=n();e=extend({renderTable:!0,renderChart:!0},e),r=$("#"+e.tabName+"CheckArea"),i=$("#"+e.tabName+"ChartTable");var p={},u={level:e.area_level,id:e.area_id,year:e.year,wintype:s,tabtype:d,page:e.table_page||1};p=l.getCheckAreaActiveObj(r),showLoadingMask(),ajax({url:e.url,data:extend(u,p),success:function(r){if(s==t()&&d==n()){var p=r.code,u=r.data;if(0==p&&u){i.html(template(c,u)),e.renderTable&&l.renderConfigTable(extend({},e,{tableData:u.table,tableDetail:e.tableDetail,tableTplId:e.tableTplId,secondPopup:!1})),e.renderChart&&o(u);var h="active",f=i.find(".chart-tab");f.length>0&&f.each(function(){function a(e){t.attr("data-active",e).find("li[data-target="+e+"]").addClass(h).siblings().removeClass(h),n.find(".chart").addClass("hide"),n.find("#"+e).removeClass("hide")}var t=$(this),n=t.closest(".chart-item").find(".js-tab-charts-wrap");console.log(e.chartTab||t.attr("data-active")),a(e.chartTab||t.attr("data-active")),t.on(CLICK_EV,"li",function(){a($(this).data("target"))})});var _=l.$monitorContent.find(".page-content-wrap"),T=_.data("jsp");T?T.reinitialise():T=_.jScrollPane(commonJSPConfig).data("jsp"),$.isFunction(a)&&a()}hideLoadingMask()}},error:function(){hideLoadingMask()}})},renderConfigTable:function(e){function a(){r.data("action-bound")||(r.on("click","td[data-action-type=area_data]",function(a){var t=$(this),n=t.data("action-area-level"),o=t.data("action-area-id");i.secondPopup.openAreaData(extend({},e,{area_level:n,area_id:o}))}).on("click","td[data-action-type=country_file]",function(e){var a=$(this).data("action-area-id");$.poorFile.showCountryFile(a)}).on("click","td[data-action-type=family_file]",function(e){var a=$(this).data("action-family-id");$.poorFile.showFamilyFile(a)}).on("click",".detail-btn",function(a){i.secondPopup.openDetail(e)}).on("click",".export-btn",function(e){t($(this).data("export-url"))}),r.data("action-bound",!0))}function t(e){var a=1e3,t=$("#exportContent");ajax({url:e,success:function(e){function n(e){t.html(template("tplExportContent",e))}var o=e.code,r=e.data;if(0==o&&r){var l=null;!function(e){function t(){ajax({url:URLS.URL_DATA_CHECK_EXPORT_RESULT,data:{export_task_id:e},success:function(e){var o=e.code,r=e.data,c=e.msg,s=r.stat;0==o&&r&&(1==s?(n(r),l=setTimeout(t,a)):(2==s?Helpers.showAlertDialog({content:"生成完成",btnPosText:"下载",btnPosCB:function(e){window.open(r.url),e.hide()}}):Helpers.showAlertDialog({title:"导出错误",content:c}),i.exportWrap.close()))},error:function(){}})}i.exportWrap.open(),n({progress:0}),t()}(r.export_task_id)}},error:function(){}})}function n(){var a=r.find(".table-pagination"),t=e.tableData.pagination.page_total,n=e.tableData.pagination.page_cur,o=e.tableData.pagination.page_cur+1,l=e.tableData.pagination.page_cur-1;a.on("click",".arrow-first",function(a){if(1==n)return 0;e.table_page=1,e.secondPopup?i.renderSecondPopupTable(e):i.renderChartTable(e)}).on("click",".arrow-end",function(a){if(console.log(n+"+"+t),n==t)return 0;e.table_page=t,e.secondPopup?i.renderSecondPopupTable(e):i.renderChartTable(e)}).on("click",".arrow-left",function(a){if(l<1)return 0;e.table_page=l,e.secondPopup?i.renderSecondPopupTable(e):i.renderChartTable(e)}).on("click",".arrow-right",function(a){if(o>t)return 0;e.table_page=o,e.secondPopup?i.renderSecondPopupTable(e):i.renderChartTable(e)})}(e=extend({},e)).tableDetail=e.tableDetail||!1;var o,r,i=this;e.secondPopup?(o=$("#"+e.tableTplId),r=$("#secondPopupTable")):(o=i.$monitorContent.find(".config-table"),r=$("#"+e.tabName+"ChartTable")),e.tableDetail?(e.tableData.hasDetailBtn=!0,o.html(template("tplConfigTable",e.tableData)),a(),e.tableData.pagination&&n()):(e.tableData.hasDetailBtn=!1,o.html(template("tplConfigTable",e.tableData)),a(),e.tableData.pagination&&n());var l=null,c=(l=e.secondPopup?$("#popupPoorMonitorSecond"):i.$monitorContent).find(".page-content-wrap"),s=l.find(".monitor-tb-wrap"),d=c.data("jsp"),p=s.data("jsp");p?p.reinitialise():p=s.jScrollPane(commonJSPConfig).data("jsp"),d?d.reinitialise():d=c.jScrollPane(commonJSPConfig).data("jsp"),p.reinitialise()},configTableFun:{},renderSecondPopupTable:function(e,a){var t=this,n=$("#popupPoorMonitorSecond #paramsCheckArea"),o={},r=t.getWinType(),i=t.getCurTabType(),l={level:e.area_level,id:e.area_id,year:e.year,month:e.month,wintype:r,tabtype:i,page:e.table_page||1};e.tableDetail=!1,o=t.getCheckAreaActiveObj(n),showLoadingMask(),ajax({url:e.url,data:extend(l,o),success:function(n){if(r==t.getWinType()&&i==t.getCurTabType()){var o=n.code,l=n.data;if(0==o&&l){var c=$("#popupPoorMonitorSecond");"area_data"==e.secondPopupType&&(l.hasSelectArea=!1,c.find(".basic-info-wrap").html(template("tplSecondPopupBasicInfo",l)),$("#secondPopupTitle").text(l.win_title)),t.renderConfigTable(extend({},e,{secondPopup:!0,tableData:l.table,tableDetail:e.tableDetail,tableTplId:"secondPopupTable"})),$.isFunction(a)&&a()}hideLoadingMask()}},error:function(){hideLoadingMask()}})},renderConfigOrder:function(e){var a=this;e.url=URLS.URL_DATA_MONITOR_ORDER_TABLE,e.params_url=URLS.URL_DATA_MONITOR_ORDER_BASIC_INFO,$("#headDownloadTable").hasClass("hide")||a.renderHeadDownloadList(e),a.$monitorContent.html(template("tplConfigOrder")),a.buildConfigCheckArea(e)},renderSecondPopupDetailList:function(e){var a=this;e=extend({},e,{url:URLS.URL_DATA_MONITOR_DETAIL_TABLE,params_url:URLS.URL_DATA_MONITOR_DETAIL_PARAMS_INFO,secondPopup:!0,secondPopupType:"detail_list"}),a.buildConfigCheckArea(e)},renderSecondPopupAreaData:function(e){var a=this;e=extend({},e,{url:URLS.URL_DATA_MONITOR_AREA_DATA_TABLE,secondPopup:!0,secondPopupType:"area_data"}),a.renderSecondPopupTable(e)},renderHeadDownloadList:function(e){showLoadingMask(),ajax({url:URLS.URL_DATA_MONITOR_HEAD_DOWNLOAD_TABLE_LIST,data:{wintype:e.wintype,id:e.area_id,level:e.area_level,year:e.year},success:function(e){var a=e.code,t=e.data;if(0==a&&t){var n=$("#monitorHeader").find("#headDownloadTable");n.html(template("tplHeadDownloadTable",t)),n.removeClass("hide")}},error:function(){hideLoadingMask()}})},renderExampleCountryBuildingRenovateStandard:function(e){function a(){var a=(new Date).getMonth()+1,o=$("#exampleCountryBuildingRenovateStandardTableSelect .select-area"),r=o.find("#selectMonth>span"),i=o.find("#selectMonth .js-select-list");r.attr("data-month",a.toString()).text(a+"月"),i.find("li").each(function(e,t){$(this).removeClass("active"),$(this).attr("data-month")==a&&$(this).addClass("active")}),n.find(".js-select-box").on("click",function(){var e=$(this),a=e.find(".select-list"),t=e.parents(".select-area").find(".js-select-box").not(this);return e.hasClass("forbid")?0:(e.toggleClass("selected"),a.toggle(),e.find(".arrow").toggleClass("arrow-on"),t.removeClass("selected").find(".select-list").hide(),t.find(".arrow").removeClass("arrow-on"),function(){var e=a.innerWidth(),t=a.innerHeight();e=e>80?80:e,a.find(".jspPane").length<1&&a.width(e),t>150&&a.jScrollPane(commonJSPConfig)}(),!1)}),n.find(".js-select-list li").on("click",function(){var a=$(this),n=($.dataMonitor,$("#exampleCountryBuildingRenovateStandardTableSelect .select-area")),o=n.find("#selectMonth>span"),r=n.find("#selectState>span");if(a.parents("#selectState").length>0){var i=a.attr("data-state"),l=n.find("#selectMonth>span").attr("data-month");$(this).siblings().removeClass("active"),$(this).addClass("active"),r.attr("data-state",$(this).attr("data-state")).text($(this).text()),e=extend(e,{month:l,state:i}),console.log(e),t(e)}if(a.parents("#selectMonth").length>0){var l=a.attr("data-month"),i=n.find("#selectState>span").attr("data-state");$(this).siblings().removeClass("active"),$(this).addClass("active"),o.attr("data-month",l.toString()).text(l+"月"),t(e=extend(e,{month:l,state:i}))}})}function t(e,a){function t(){return e.wintype||s.getWinType()}function n(){return e.tabtype||s.getCurTabType()}function r(){u.data("action-bound")||(u.on("click","td[data-action-type=area_data]",function(a){var t=$(this),n=t.data("action-area-level"),o=t.data("action-area-id");s.secondPopup.openAreaData(extend({},e,{area_level:n,area_id:o}))}).on("click","td[data-action-type=country_file]",function(e){var a=$(this).data("action-area-id");$.poorFile.showCountryFile(a)}).on("click","td[data-action-type=family_file]",function(e){var a=$(this).data("action-family-id");$.poorFile.showFamilyFile(a)}).on("click",".detail-btn",function(a){var t=$("#exampleCountryBuildingRenovateStandardTableSelect .select-area").find("#selectMonth>span").attr("data-month");e.month=parseInt(t),s.secondPopup.openDetail(e)}).on("click",".export-btn",function(e){i($(this).data("export-url"))}),u.data("action-bound",!0))}function i(e){var a,t=window.Helpers,n=t.ajax,o={open:function(){a||(a=$("#exportWrap")),a.show()},close:function(){a.hide()}},r=1e3,i=$("#exportContent");n({url:e,success:function(e){function a(e){i.html(template("tplExportContent",e))}var l=e.code,c=e.data;if(0==l&&c){var s=null;!function(e){function i(){n({url:URLS.URL_DATA_CHECK_EXPORT_RESULT,data:{export_task_id:e},success:function(e){var n=e.code,l=e.data,c=e.msg,d=l.stat;0==n&&l&&(1==d?(a(l),s=setTimeout(i,r)):(2==d?t.showAlertDialog({content:"生成完成",btnPosText:"下载",btnPosCB:function(e){window.open(l.url),e.hide()}}):t.showAlertDialog({title:"导出错误",content:c}),o.close()))},error:function(){}})}o.open(),a({progress:0}),i()}(c.export_task_id)}},error:function(){}})}function l(){var e=$("#popupPoorMonitor"),a=e.find(".page-content-wrap"),t=e.find(".monitor-tb-wrap"),n=a.data("jsp"),o=t.data("jsp");o?o.reinitialise():o=t.jScrollPane(commonJSPConfig).data("jsp"),n?n.reinitialise():n=a.jScrollPane(commonJSPConfig).data("jsp"),o.reinitialise()}function c(e){showLoadingMask(),console.log(e.table_url),ajax({url:e.table_url,data:extend(f,{page:e.table_page}),success:function(a){var t=a.code,n=a.data;if(0==t&&n){var i={tableData:n.table,table_page:e.table_page,table_url:e.table_url};n.table.hasDetailBtn=!0,o.html(template("tplConfigTable",n.table)),l(),r(),e.tableData.pagination&&$.components.tableEvent.bindPagination(o,i,c)}hideLoadingMask()},error:function(){hideLoadingMask()}})}var s=$.dataMonitor,d=(e.TabName,e.tplID||e.TabName,t()),p=n(),u=$("#"+e.tabName+"ChartTable"),h=(new Date).getMonth()+1,f={level:(e=extend({renderTable:!0,renderChart:!0,month:e.month||h,state:e.state||"doing"},e)).area_level,id:e.area_id,year:e.year,wintype:d,tabtype:p,page:e.table_page||1,table_month:e.month,table_state:e.state};showLoadingMask();var _=e.table_url;ajax({url:_,data:f,success:function(a){if(d==t()&&p==n()){var i=a.code,s=a.data;if(0==i&&s){s.table.hasDetailBtn=!0,o.html(template("tplConfigTable",s.table)),l();var u={tableData:s.table,table_page:1,table_url:_};r(e),u.tableData.pagination&&$.components.tableEvent.bindPagination(o,u,c)}hideLoadingMask()}},error:function(){hideLoadingMask()}})}var n,o,r=this,i="tpl"+e.TabName;e.chart_url=URLS.URL_DATA_EXAMPLE_COUNTRY_COUNTRY_RENOVATE_STANDARD_CHART,e.table_url=URLS.URL_DATA_EXAMPLE_COUNTRY_COUNTRY_RENOVATE_STANDARD_TABLE,e.tableDetail=!0,e.chartTab="exampleCountryBuildingRenovateStandardChartRenovateStandardRate",console.log(i),r.$monitorContent.html(template(i)),function(e,r){function i(){return e.wintype||s.getWinType()}function l(){return e.tabtype||s.getCurTabType()}function c(a){var t=[];for(var n in a)"chart_config"==n.substring(0,12)&&t.push({name:n,data:a[n]});for(var o=0;o<t.length;o++){var r=a[t[o].name],i=t[o].name.substring(13);if(e.chartHeaderId)l=e.chartHeaderId+$.components.underlineToCamel(i);else var l=e.tabName+"Chart"+$.components.underlineToCamel(i);echarts.init(document.getElementById(l)).setOption(commonEchartConfig[r.convert_method](r.config))}}var s=this,d=$("#"+e.tabName+"ChartTable"),p=(e.TabName,e.tplID||"tpl"+e.TabName+"ChartTable"),u=i(),h=l(),f={},_={level:(e=extend({renderTable:!0,renderChart:!0},e)).area_level,id:e.area_id,year:e.year,wintype:u,tabtype:h};showLoadingMask(),ajax({url:e.chart_url,data:extend(_,f),success:function(s){if(u==i()&&h==l()){var f=s.code,_=s.data;if(0==f&&_){d.html(template(p,_)),o=$("#exampleCountryBuildingRenovateStandardTable"),n=$("#exampleCountryBuildingRenovateStandardTableSelect"),a(),e.renderChart&&c(_),t(e);var T="active",C=d.find(".chart-tab");C.length>0&&C.each(function(){function a(e){t.attr("data-active",e).find("li[data-target="+e+"]").addClass(T).siblings().removeClass(T),n.find(".chart").addClass("hide"),n.find("#"+e).removeClass("hide")}var t=$(this),n=t.closest(".chart-item").find(".js-tab-charts-wrap");console.log(e.chartTab||t.attr("data-active")),a(e.chartTab||t.attr("data-active")),t.on(CLICK_EV,"li",function(){a($(this).data("target"))})}),$.isFunction(r)&&r()}hideLoadingMask()}},error:function(){hideLoadingMask()}})}(e)},renderExampleCountryBuildingPromoteCreation:function(e){return hideLoadingMask(),0}},$.dataMonitor.init()});