function zEditTreeDIYCallback(treeId,callType,parameter,defaults){var zTree=$.fn.zTree.getZTreeObj(treeId),flag=defaults,call=zTree.diyCallback;if(call.hasOwnProperty(callType)&&common.utils.isFunction(call[callType]))var flag=eval("("+call[callType]+"(parameter.treeId, parameter.treeNode))");return flag}function zEditTree(e,t,o,r,a){this.treeObj={},this.container=e,$("#"+e).length&&(this.parameter=this.defaults(t,o,r,a),this.parameter.option.async&&""!==this.parameter.option.url?this.treeObj=this.asyncTree():(this.treeObj=$.fn.zTree.init($("#"+e),this.parameter.setting,this.parameter.zNodes),this.treeParams(this.treeObj)))}$.namespace("common.plugins.ztree"),zEditTree.prototype.asynReload=function(){this.parameter.option.async&&""!==this.parameter.option.url&&this.asyncTree()},zEditTree.prototype.onNewRoot=function(){if(this.parameter.noRoot){var returnNode=void 0,call=this.parameter.callback;return call.hasOwnProperty("noNewRoot")&&common.utils.isFunction(call.noNewRoot)&&(returnNode=eval("("+call.noNewRoot+"(this.defaultRootNode[0].id, this.defaultRootNode[0].name,this.defaultRootNode[0].pId))")),returnNode||this.defaultRootNode}},zEditTree.prototype.asyncTree=function(){var e=this,t=e.parameter.option.url,o=e.parameter.option.params,r=e.parameter.option.mapper;$.ajax({type:"POST",url:t,data:o,cache:!0,dataType:"json",success:function(t){var o=[];if(!common.utils.isArrayEmpty(t))for(var a=0;a<t.length;a++){var n={};for(var i in r)n[i]=t[a][r[i]];!n.hasOwnProperty("isParent")&&e.parameter.option.showFolder&&(n.isParent=!0),o.push(n)}var d=$.fn.zTree.init($("#"+e.container),e.parameter.setting,o);return e.treeParams(d),d}})},zEditTree.prototype.treeParams=function(e){e.diyCallback=this.parameter.callback,e.Z_EDIT_TREE_COUNT=1,e.showFolder=this.parameter.option.showFolder,e.Z_EDIT_TREE_NEW_EDIT_NAME=this.parameter.option.newEditName,this.parameter.option.isExpand&&e.expandAll(this.parameter.option.isExpand)},zEditTree.prototype.beforeDrag=function(e,t){return zEditTreeDIYCallback(e,"beforeDrag",{treeId:e,treeNode:t},!1)},zEditTree.prototype.beforeEditName=function(e,t){return zEditTreeDIYCallback(e,"beforeEditName",{treeId:e,treeNode:t},!0)},zEditTree.prototype.beforeRemove=function(e,t){return $.fn.zTree.getZTreeObj(e).selectNode(t),!!confirm("是否确认删除“"+t.name+"”节点？")&&zEditTreeDIYCallback(e,"beforeRemove",{treeId:e,treeNode:t},!0)},zEditTree.prototype.beforeRename=function(e,t,o){var r=$.fn.zTree.getZTreeObj(e);return 0===o.length?(layer.msg("节点名称不能为空！",{icon:2,shade:.2}),setTimeout(function(){r.editName(t)},10),!1):zEditTreeDIYCallback(e,"beforeRename",{treeId:e,treeNode:t},!0)},zEditTree.prototype.onRemove=function(e,t,o){zEditTreeDIYCallback(t,"onRemove",{treeId:t,treeNode:o})},zEditTree.prototype.onRename=function(e,t,o){zEditTreeDIYCallback(t,"onRename",{treeId:t,treeNode:o})},zEditTree.prototype.onDrop=function(e,treeId,treeNodes,targetNode,moveType,isCopy){var zTree=$.fn.zTree.getZTreeObj(treeId),call=zTree.diyCallback;call.hasOwnProperty("onDrop")&&eval(call.onDrop+"(treeId, treeNodes, targetNode, moveType, isCopy)")},zEditTree.prototype.onNodeClick=function(e,treeId,treeNode,clickFlag){var zTree=$.fn.zTree.getZTreeObj(treeId),call=zTree.diyCallback;call.hasOwnProperty("onClick")&&eval(call.onClick+"(treeId, treeNode,clickFlag)")},zEditTree.prototype.addHoverDom=function(treeId,treeNode){var sObj=$("#"+treeNode.tId+"_span");if(!(treeNode.editNameFlag||$("#addBtn_"+treeNode.id).length>0)){var addStr="<span class='button add' id='addBtn_"+treeNode.id+"' title='新增叶子节点' onfocus='this.blur();'></span>";sObj.after(addStr);var btn=$("#addBtn_"+treeNode.id);btn&&btn.bind("click",function(){var zTree=$.fn.zTree.getZTreeObj(treeId),call=zTree.diyCallback;call.hasOwnProperty("beforeNew")&&eval(call.beforeNew+"(treeId, treeNode)");var nodeid=common.utils.guid(),nodeName=zTree.Z_EDIT_TREE_NEW_EDIT_NAME+"_"+zTree.Z_EDIT_TREE_COUNT++,parentId=treeNode.id;return zTree.addNodes(treeNode,{id:nodeid,pId:parentId,name:nodeName,isParent:zTree.showFolder}),call.hasOwnProperty("onNew")&&eval(call.onNew+"(treeId, treeNode, nodeid, nodeName, parentId)"),!1})}},zEditTree.prototype.removeHoverDom=function(e,t){$("#addBtn_"+t.id).unbind().remove()},zEditTree.prototype.isRemove=function(e,t){return!0},zEditTree.prototype.noRootRename=function(e,t){return!0},zEditTree.prototype.defaults=function(e,t,o,r){var a={},n={},i=!0,d={async:!1,url:"",params:{},mapper:{id:"id",name:"name",pId:"pId"},newRootName:"默认根节点",newEditName:"新节点",isExpand:!1,showFolder:!1,showRenameBtn:!0,showRemoveBtn:!0,renameTitle:"重命名",removeTitle:"删除",isRootRename:!0},l=common.utils.setDefaultOption(r,d),s=common.utils.guid();this.defaultRootNode=[{id:s,pId:-1,name:l.newRootName,isParent:!0}];var m=this.defaultRootNode;l.showRemoveBtn&&(l.showRemoveBtn=this.isRemove),l.showRenameBtn&&!l.isRootRename&&(l.showRenameBtn=this.noRootRename);var p={view:{addHoverDom:this.addHoverDom,removeHoverDom:this.removeHoverDom,selectedMulti:!1},edit:{enable:!0,showRemoveBtn:l.showRemoveBtn,showRenameBtn:l.showRenameBtn,removeTitle:l.removeTitle,renameTitle:l.renameTitle,editNameSelectAll:!0},data:{simpleData:{enable:!0}},callback:{beforeDrag:this.beforeDrag,beforeEditName:this.beforeEditName,beforeRemove:this.beforeRemove,beforeRename:this.beforeRename,onRemove:this.onRemove,onRename:this.onRename,onClick:this.onNodeClick}};return common.utils.isJson(t)&&(a=$.extend({},t,p)),common.utils.isArrayEmpty(e)||(i=!1,m=e),common.utils.isJson(o)&&(n=o),{noRoot:i,zNodes:m,setting:a,callback:n,option:l}};