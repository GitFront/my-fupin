$.namespace("common.report.highcharts"),Array.prototype.contains=function(t){for(var o=this.length;o--;)if(this[o]===t)return!0;return!1},Highcharts.setOptions({lang:{drillUpText:"返回 > {series.name}"}});var Highmap={ChartDataFormate:{FormatGroupData:function(t){common.utils.isArray(t)||(t=[]);for(var o=new Array,a=new Array,e=new Array,r=0;r<t.length;r++)o.contains(t[r].name)||o.push(t[r].name),a.contains(t[r].group)||a.push(t[r].group);for(r=0;r<a.length;r++){var n={},i=a[r],c=!0;a[r].endsWith("|hide")&&(c=!1,i=a[r].replace("|hide",""));for(var p=new Array,s=0;s<t.length;s++)for(var l=0;l<o.length;l++)a[r]==t[s].group&&t[s].name==o[l]&&p.push(t[s].value);n={name:i,data:p,visible:c},e.push(n)}return{category:o,series:e}}},MapOptionTemplates:{Map:function(container,data,mapData,joinBy,opt){var pointFormat=Highmap.utils.convValueFormat(opt.valueMapper),option={chart:{renderTo:container},title:{text:opt.title},credits:{enabled:!1},subtitle:{text:null},legend:opt.legend,colorAxis:{min:0,stops:opt.colorStops},colors:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,void 0],[1,Highcharts.Color(void 0).brighten(-.3).get("rgb")]]},mapNavigation:{enabled:opt.navigation,enableButtons:opt.navigationButton},plotOptions:{series:{cursor:opt.cursor,events:{click:function(e){var funcName=opt.doClick;common.utils.isFunction(funcName)&&eval(funcName+"(e.point)")}}}},series:[{data:data,mapData:Highcharts.maps[mapData],joinBy:joinBy,name:opt.mapName,color:Highcharts.getOptions().colors[2],states:{hover:{color:"#BADA55"}},dataLabels:{enabled:!0,format:"{point.properties.name}"},tooltip:{headerFormat:"",pointFormat:pointFormat}}]};return option}},create:{init:function(container,data,mapData,joinBy,option){var type="Map",option_=Highmap.utils.defaultOption(option);option_.container=container,option_.optionType=type;var opt=eval("Highmap.MapOptionTemplates."+type+"(container,data,mapData,joinBy,option_)"),map=new Highcharts.Map(opt),obj={chart:map,chartType:type,option:option_,data:data,mapData:mapData,joinBy:joinBy},id=common.report.highcharts.object.add(obj);return id}},reload:function(chartid,data,newOption){var obj=common.report.highcharts.object.get(chartid);if(null!=obj){var chart=obj.chart;chart.showLoading();var opt=obj.option,mapData=obj.mapData,joinBy=obj.joinBy,container=opt.container,type=opt.optionType;common.utils.isDefined(data)||(data=obj.data),common.utils.isDefined(newOption)&&(opt=Highmap.utils.defaultOption(newOption),opt.container=container,opt.optionType=type);var option=eval("Highmap.MapOptionTemplates."+type+"(container,data,mapData,joinBy,opt)");return chart.hideLoading(),chart.destroy(),chart=new Highcharts.Map(option),obj.chart=chart,obj.option=opt,obj.data=data,common.report.highcharts.object.reset(chartid,obj),!0}return!1},remove:function(t){return!!common.report.highcharts.object.containsKey(t)&&(common.report.highcharts.object.get(t).chart.destroy(),common.report.highcharts.object.remove(t),!0)},ajax:{init:function(t,o,a,e,r,n){var i=Highmap.create.init(t,[],e,r,n),c=common.report.highcharts.object.get(i),p=c.chart;return p.showLoading(),a=common.utils.strToJson(a),$.ajax({type:"POST",url:o,data:a,cache:!0,dataType:"json",success:function(t){Highmap.reload(i,t),p.hideLoading(),(c=common.report.highcharts.object.get(i)).url=o,c.parameters=a,common.report.highcharts.object.reset(i,c)}}),i},reload:function(t,o,a,e){var r=common.report.highcharts.object.get(t);if(null==r)return!1;if(common.utils.isEmpty(o)){var n=r.data;return Highmap.reload(t,n,e)}var i=r.chart;i.showLoading(),common.utils.isEmpty(o)&&(o=r.url),common.utils.isEmpty(a)&&(a=r.parameters),a=common.utils.strToJson(a),$.ajax({type:"POST",url:o,data:a,cache:!0,dataType:"json",success:function(n){return Highmap.reload(t,n,e),i.hideLoading(),r=common.report.highcharts.object.get(t),r.url=o,r.parameters=a,common.report.highcharts.object.reset(t,r),!0}})}},mybatis:{Map:function(t,o,a,e,r,n,i){var c=ctx+"/a/report/highmaps/mapData/load",p={};return p.queryName=o,p.param=common.utils.strToJson(a),p.mapper=common.utils.strToJson(e),p.joinBy=n,Highmap.ajax.init(t,c,p,r,n,i)},reload:function(t,o,a,e,r){var n=common.report.highcharts.object.get(t);if(null!=n){var i=n.url,c=n.parameters;return common.utils.isEmpty(o)||(c.queryName=o),common.utils.isEmpty(a)||(c.param=common.utils.strToJson(a)),common.utils.isEmpty(e)||(c.mapper=common.utils.strToJson(e)),Highmap.ajax.reload(t,i,c,r)}return!1}},utils:{defaultOption:function(t){var o={title:"",mapName:"",colorStops:["#EFEFFF",Highcharts.getOptions().colors[0],"#006cee"],valueDecimal:0,percentDecimal:2,legend:!0,legendFloat:!1,legendAlign:"right",navigation:!0,navigationButton:!0,valueMapper:[{key:"value",name:"数值"}],doClick:""},a=common.utils.setDefaultOption(t,o);return a.legend=this.convLegend(a),a.colorStops=this.convColorstops(a.colorStops),a.navigation||(a.navigationButton=!1),a.cursor="",common.utils.isFunction(a.doClick)&&(a.cursor="pointer"),a},convLegend:function(t){var o={};if(!t.legend)return o.enabled=!1,o;switch(o.enabled=!0,o.floating=t.legendFloat,t.legendAlign){case"left":o.align="left",o.layout="vertical",o.verticalAlign="middle";break;case"top":o.layout="horizontal",o.verticalAlign="top";break;case"bottom":o.layout="horizontal",o.verticalAlign="bottom";break;default:o.align="right",o.layout="vertical",o.verticalAlign="middle"}return o},convColorstops:function(t){var o=[[0,"#EFEFFF"],[.5,Highcharts.getOptions().colors[0]],[1,"#006cee"]];if(!common.utils.isArray(t))return o;var a=new Array,e=t.length;switch(e){case 0:case 1:a=o;break;default:for(var r=1/(e-1),n=0;n<e;n++)a.push([r*n,t[n]])}return a},convValueFormat:function(t){var o='<p><b style="font-weight:bold;color:#F58221;font-size:13px">{point.properties.name}<b/><br>';if(common.utils.isArray(t)){for(var a=0;a<t.length;a++)o+=0===a?'<b style="color:#0000FF;font-size:12px">'+t[a].name+'：</b><b style="font-weight:bold;color:#0000FF;">{point.'+t[a].key+"}</b><br/>":t[a].name+"：<b>{point."+t[a].key+"}</b><br/>";o+="</p>"}else common.utils.isJson(t)&&(o+='<b style="color:#0000FF;font-size:12px">'+t.name+'：</b><b style="font-weight:bold;color:#0000FF;">{point.'+t.key+"}</b><br/></p>");return o}}};